<?xml version="1.0" encoding="UTF-8"?>

<pageSetting id="testhyyj" title="测试行员业绩" type="yjgx" version="1.0.0.0" desc="从我我我7777" pid=""> 
  <mainPage> 
    <tags> 
      <tag name="Date" fieldName="JXDX_SJYHQY.qyrq" condition="between ? and 1" col="0" row="0" colspan="1" label="统计日期"> 
        <attribute key="label" value="统计日期"/>  
        <attribute key="name" value="TJRQ"/>  
        <attribute key="dateFmt" value="yyyyMMdd"/>  
        <attribute key="defValType" value="sysDate"/>  
        <attribute key="styleClass" value=""/>  
        <attribute key="minDate" value="no"/>  
        <attribute key="defVal" value=""/>  
        <attribute key="style" value=""/>  
        <attribute key="isRequired" value="true"/>  
        <attribute key="editable" value="true"/> 
      </tag> 
    </tags>  
    <javascript/> 
  </mainPage>  
  <listPage> 
    <tags/>  
    <javascript/> 
  </listPage>  
  <table page="true" id="testhyyj_table_main"> 
    <col id="DQFPGX" title="当前分配关系" align="center" type="string" width="200" format="" frozen="" exp="true"/>  
    <col id="hth" title="hth" align="left" type="string" width="120" format="" frozen="" exp="true"/>  
    <col id="QYRQ" title="qyrq1" align="right" type="hidden" width="180" format="true" frozen="false" hidden="true"/> 
  </table>  
  <table page="true" id="testhyyj_table_list"> 
    <col id="JGDH" title="机构代号" align="left" type="string" width="100" format="" frozen=""/>  
    <col id="JGMC" title="机构名称" align="left" type="string" width="150" format="" frozen=""/>  
    <col id="HYDH" title="行员代号" align="left" type="string" width="80" format="" frozen=""/>  
    <col id="HYMC" title="行员名称" align="left" type="string" width="90" format="" frozen=""/>  
    <col id="QSRQ" title="起始日期" align="left" type="string" width="80" format="" frozen=""/>  
    <col id="JSRQ" title="结束日期" align="left" type="string" width="80" format="" frozen=""/>  
    <col id="ZLBL" title="增量比例" align="left" type="string" width="80" format="" frozen=""/>  
    <col id="QYRQ" title="qyrq1" align="right" type="hidden" width="180" format="true" frozen="false" hidden="true"/> 
  </table>  
  <rels> 
    <items id="testhyyj_table_main"> 
      <item name="hideZd" compareValue="main" operate="isEqual"/> 
    </items>  
    <items id="testhyyj_table_list"> 
      <item name="hideZd" compareValue="list" operate="isEqual"/> 
    </items> 
  </rels>  
  <performance> 
    <primaryKey>QYRQ</primaryKey> 
  </performance>  
  <sqlMap> 
    <select id="dn0.testhyyj_select_validateDate" parameterClass="java.util.Map" resultClass="java.lang.Integer"> 
      <isNotEmpty property="db"><![CDATA[/**!mycat:datanode=$db$**/]]></isNotEmpty> select count(1) from JXDX_SJYHQY JXDX_SJYHQY where 1=1 and JXDX_SJYHQY.QYRQ = $QYRQ$ and qykey &gt; $QSRQ$
    </select>  
    <select id="dn0.testhyyj_select_maxQsrq" parameterClass="java.util.Map" resultClass="java.lang.Integer"> 
      <isNotEmpty property="db"><![CDATA[/**!mycat:datanode=$db$**/]]></isNotEmpty> select max(qsrq) from dxgx_yjgx_sjyh where 1=1 and QYRQ = $QYRQ$
    </select>  
    <select id="dn0.testhyyj_select_khrq" parameterClass="java.util.Map" resultClass="java.lang.Integer"> 
      <isNotEmpty property="db"><![CDATA[/**!mycat:datanode=$db$**/]]></isNotEmpty> select qykey from JXDX_SJYHQY where 1=1 and QYRQ = $QYRQ$
    </select>  
    <select id="dn0.testhyyj_select_minQsrq" parameterClass="java.util.Map" resultClass="java.lang.Integer"> 
      <isNotEmpty property="db"><![CDATA[/**!mycat:datanode=$db$**/]]></isNotEmpty> select min(qsrq) from dxgx_yjgx_sjyh gx where 1=1 and gx.QYRQ = $QYRQ$
    </select>  
    <select id="dn0.testhyyj_select_mainPage_db2" parameterClass="java.util.Map" resultClass="java.util.HashMap" remapResults="true"> 
      <isNotEmpty property="db"><![CDATA[/**!mycat:datanode=$db$**/]]></isNotEmpty> select JXDX_SJYHQY.QYRQ,JXDX_SJYHQY.hth as hth ,case when gxyj.qykey is null then '无关系' else gxyj.DQFPGX end dqfpgx from JXDX_SJYHQY JXDX_SJYHQY left outer join ( select dxgx_yjgx_sjyh.qykey, listagg(khdx_hy.hymc||'|'||f_numtochar(dxgx_yjgx_sjyh.zlbl)||',') as DQFPGX from khdx_hy khdx_hy inner join dxgx_yjgx_sjyh dxgx_yjgx_sjyh on dxgx_yjgx_sjyh.khdxdh=khdx_hy.khdxdh and $sysdate$ between dxgx_yjgx_sjyh.qsrq and dxgx_yjgx_sjyh.jsrq group by dxgx_yjgx_sjyh.qykey) gxyj on gxyj.qykey=JXDX_SJYHQY.qykey inner join khdx_jg khdx_jg on khdx_jg.jgdh=JXDX_SJYHQY.jgdh inner join table(FN_GETSJJG_JAVA_QX($sysdate$,$login_khdxdh$,$login_khdxdh$)) qx on qx.khdxdh=khdx_jg.khdxdh where 1=1 
      <isNotEmpty property="TJRQ">and JXDX_SJYHQY.qyrq between ? and 1 $TJRQ$</isNotEmpty> order by JXDX_SJYHQY.qykey
    </select>  
    <select id="dn0.testhyyj_select_mainPage_ora" parameterClass="java.util.Map" resultClass="java.util.HashMap" remapResults="true"> 
      <isNotEmpty property="db"><![CDATA[/**!mycat:datanode=$db$**/]]></isNotEmpty> select JXDX_SJYHQY.QYRQ,JXDX_SJYHQY.hth as hth, F_WM_CONCAT(khdx_hy.hymc || dxgx_yjgx_sjyh.zlbl) DQFPGX ,case when gxyj.qykey is null then '无关系' else gxyj.DQFPGX end dqfpgx from JXDX_SJYHQY JXDX_SJYHQY left outer join ( select dxgx_yjgx_sjyh.qykey, listagg(khdx_hy.hymc||'|'||f_numtochar(dxgx_yjgx_sjyh.zlbl)||',') as DQFPGX from khdx_hy khdx_hy inner join dxgx_yjgx_sjyh dxgx_yjgx_sjyh on dxgx_yjgx_sjyh.khdxdh=khdx_hy.khdxdh and $sysdate$ between dxgx_yjgx_sjyh.qsrq and dxgx_yjgx_sjyh.jsrq group by dxgx_yjgx_sjyh.qykey) gxyj on gxyj.qykey=JXDX_SJYHQY.qykey inner join khdx_jg khdx_jg on khdx_jg.jgdh=JXDX_SJYHQY.jgdh inner join table(FN_GETSJJG_JAVA_QX($sysdate$,$login_khdxdh$,$login_khdxdh$)) qx on qx.khdxdh=khdx_jg.khdxdh where 1=1 
      <isNotEmpty property="TJRQ">and JXDX_SJYHQY.qyrq between ? and 1 $TJRQ$</isNotEmpty> order by JXDX_SJYHQY.qykey
    </select>  
    <select id="dn0.testhyyj_select_mainCount_db2" parameterClass="java.util.Map" resultClass="java.lang.Integer" remapResults="true"> 
      <isNotEmpty property="db"><![CDATA[/**!mycat:datanode=$db$**/]]></isNotEmpty> select count(1) as count from JXDX_SJYHQY JXDX_SJYHQY inner join khdx_jg khdx_jg on khdx_jg.jgdh=JXDX_SJYHQY.jgdh inner join table(FN_GETSJJG_JAVA_QX($sysdate$,$login_khdxdh$,$JGKHDXDH$)) qx on qx.khdxdh=khdx_jg.khdxdh where 1=1 
      <isNotEmpty property="TJRQ">and JXDX_SJYHQY.qyrq between ? and 1 $TJRQ$</isNotEmpty> 
    </select>  
    <select id="dn0.testhyyj_select_mainCount_ora" parameterClass="java.util.Map" resultClass="java.lang.Integer" remapResults="true"> 
      <isNotEmpty property="db"><![CDATA[/**!mycat:datanode=$db$**/]]></isNotEmpty> select count(1) as count from JXDX_SJYHQY JXDX_SJYHQY inner join khdx_jg khdx_jg on khdx_jg.jgdh=JXDX_SJYHQY.jgdh inner join table(FN_GETSJJG_JAVA_QX($sysdate$,$login_khdxdh$,$JGKHDXDH$)) qx on qx.khdxdh=khdx_jg.khdxdh where 1=1 
      <isNotEmpty property="TJRQ">and JXDX_SJYHQY.qyrq between ? and 1 $TJRQ$</isNotEmpty> 
    </select>  
    <select id="dn0.testhyyj_select_gxmxPage" parameterClass="java.util.Map" resultClass="java.util.HashMap"> 
      <isNotEmpty property="db"><![CDATA[/**!mycat:datanode=$db$**/]]></isNotEmpty> select distinct khdx_jg.JGDH as JGDH,khdx_hy.HYMC as HYMC,JXDX_SJYHQY.QYRQ,khdx_hy.HYDH as HYDH,DXGX_YJGX_SJYH.QSRQ as QSRQ,DXGX_YJGX_SJYH.JSRQ as JSRQ,khdx_jg.JGMC as JGMC,DXGX_YJGX_SJYH.ZLBL as ZLBL ,case when gxyj.qykey is null then '无关系' else gxyj.DQFPGX end dqfpgx from dxgx_yjgx_sjyh dxgx_yjgx_sjyh inner join JXDX_SJYHQY JXDX_SJYHQY on 1=1 and JXDX_SJYHQY.QYRQ=dxgx_yjgx_sjyh.QYRQ inner join khdx_hy khdx_hy on dxgx_yjgx_sjyh.khdxdh=khdx_hy.khdxdh inner join khdx_jgcy khdx_jgcy on khdx_hy.khdxdh=khdx_jgcy.khdxdh inner join khdx_jg khdx_jg on khdx_jgcy.jgkhdxdh=khdx_jg.khdxdh and $sysdate$ between khdx_jgcy.qsrq and khdx_jgcy.jsrq where 1=1 and dxgx_yjgx_sjyh.QYRQ = $QYRQ$ order by dxgx_yjgx_sjyh.qsrq
    </select>  
    <select id="dn0.testhyyj_select_gxmxCount" parameterClass="java.util.Map" resultClass="java.lang.Integer"> 
      <isNotEmpty property="db"><![CDATA[/**!mycat:datanode=$db$**/]]></isNotEmpty> select count(1) from (select distinct khdx_jg.JGDH as JGDH,khdx_hy.HYMC as HYMC,JXDX_SJYHQY.QYRQ,khdx_hy.HYDH as HYDH,DXGX_YJGX_SJYH.QSRQ as QSRQ,DXGX_YJGX_SJYH.JSRQ as JSRQ,khdx_jg.JGMC as JGMC,DXGX_YJGX_SJYH.ZLBL as ZLBL ,case when gxyj.qykey is null then '无关系' else gxyj.DQFPGX end dqfpgx from dxgx_yjgx_sjyh dxgx_yjgx_sjyh inner join JXDX_SJYHQY JXDX_SJYHQY on 1=1 and JXDX_SJYHQY.QYRQ=dxgx_yjgx_sjyh.QYRQ inner join khdx_hy khdx_hy on dxgx_yjgx_sjyh.khdxdh=khdx_hy.khdxdh inner join khdx_jgcy khdx_jgcy on khdx_hy.khdxdh=khdx_jgcy.khdxdh inner join khdx_jg khdx_jg on khdx_jgcy.jgkhdxdh=khdx_jg.khdxdh and $sysdate$ between khdx_jgcy.qsrq and khdx_jgcy.jsrq where 1=1 and dxgx_yjgx_sjyh.QYRQ = $QYRQ$ order by dxgx_yjgx_sjyh.qsrq) a
    </select>  
    <delete id="dn0.testhyyj_delete_last_yjgx" parameterClass="java.util.Map"> 
      <isNotEmpty property="db"><![CDATA[/**!mycat:datanode=$db$**/]]></isNotEmpty> delete from dxgx_yjgx_sjyh where 1=1 and QYRQ = $QYRQ$ and jsrq=29991231
    </delete>  
    <update id="dn0.testhyyj_before_insert_yjgx2" parameterClass="java.util.Map"> 
      <isNotEmpty property="db"><![CDATA[/**!mycat:datanode=$db$**/]]></isNotEmpty> update dxgx_yjgx_sjyh set jsrq=$BEFORE$ where 1=1 and QYRQ = $QYRQ$ and qsrq=(select max(qsrq) from dxgx_yjgx_sjyh where 1=1 and QYRQ = $QYRQ$)
    </update>  
    <insert id="dn0.testhyyj_before_insert_yjgx" parameterClass="java.util.Map"> 
      <isNotEmpty property="db"><![CDATA[/**!mycat:datanode=$db$**/]]></isNotEmpty> update dxgx_yjgx_sjyh set jsrq=$BEFORE$ where 1=1 and QYRQ = $QYRQ$ and jsrq=29991231
    </insert>  
    <insert id="dn0.testhyyj_insert_yjgx" parameterClass="java.util.Map"> 
      <isNotEmpty property="db"><![CDATA[/**!mycat:datanode=$db$**/]]></isNotEmpty> insert into DXGX_YJGX_SJYH(qykey,khdxdh,qsrq,jsrq,zlbl) values('$qykey$',$khdxdh$,$qsrq$,$jsrq$,$zlbl$)
    </insert>  
    <delete id="dn0.testhyyj_delete_yjgx" parameterClass="java.util.Map"> 
      <isNotEmpty property="db"><![CDATA[/**!mycat:datanode=$db$**/]]></isNotEmpty> delete from dxgx_yjgx_sjyh gx where 1=1 and gx.QYRQ = $QYRQ$ and gx.jsrq=29991231
    </delete>  
    <update id="dn0.testhyyj_after_delete_yjgx" parameterClass="java.util.Map"> 
      <isNotEmpty property="db"><![CDATA[/**!mycat:datanode=$db$**/]]></isNotEmpty> update dxgx_yjgx_sjyh set jsrq=29991231 where 1=1 and QYRQ = $QYRQ$ and jsrq=(select max(jsrq) from dxgx_yjgx_sjyh where 1=1 and QYRQ = $QYRQ$)
    </update>  
    <select id="dn0.testhyyj_select_maxjldh" parameterClass="java.util.Map" resultClass="java.lang.Integer"> 
      <isNotEmpty property="db"><![CDATA[/**!mycat:datanode=$db$**/]]></isNotEmpty> select coalesce(max(jldh),0) from 0
    </select>  
    <insert id="dn0.testhyyj_insert_gxrz" parameterClass="java.util.Map"> 
      <isNotEmpty property="db"><![CDATA[/**!mycat:datanode=$db$**/]]></isNotEmpty> 
    </insert>  
    <insert id="dn0.testhyyj_insert_gxjl" parameterClass="java.util.Map"> 
      <isNotEmpty property="db"><![CDATA[/**!mycat:datanode=$db$**/]]></isNotEmpty> 
    </insert> 
  </sqlMap> 
</pageSetting>
