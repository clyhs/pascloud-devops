<?xml version="1.0" encoding="UTF-8"?>
<pageSetting id="jgyjbb" title="机构业绩报表" type="query" version="1.0.0.0" pid="" desc="标准版">
  <conPart>
    <tags>
      <tag row="0" col="0" colspan="1" rowspan="1" name="Date" label="统计日期">
        <attribute key="dateFmt" value="yyyyMMdd" />
        <attribute key="defValType" value="sysDate" />
        <attribute key="editable" value="true" />
        <attribute key="isRequired" value="true" />
        <attribute key="name" value="tjrq" />
        <attribute key="minDate" value="no" />
      </tag>
      <tag row="0" col="1" colspan="1" rowspan="1" name="NewJg" label="机构">
        <attribute key="cascadeCheck" value="true" />
        <attribute key="editable" value="true" />
        <attribute key="ckbz" value="jg" />
        <attribute key="isRequired" value="true" />
        <attribute key="name" value="jgkhdxdh" />
        <attribute key="multiple" value="true" />
      </tag>
      <tag row="0" col="2" colspan="1" rowspan="1" name="Dmms" label="业绩类型">
        <attribute key="width" value="100px;" />
        <attribute key="dmmc" value="yjlx" />
        <attribute key="editable" value="true" />
        <attribute key="name" value="yjlx" />
        <attribute key="isAll" value="false" />
        <attribute key="multiple" value="false" />
      </tag>
      <tag row="0" col="3" colspan="1" rowspan="1" name="Dmms" label="机构等级">
        <attribute key="width" value="80px;" />
        <attribute key="dmmc" value="jgdj" />
        <attribute key="editable" value="true" />
        <attribute key="name" value="jgdj" />
        <attribute key="isAll" value="true" />
        <attribute key="multiple" value="false" />
      </tag>
      <tag row="0" col="3" colspan="1" rowspan="1" name="Hidden" label="">
        <attribute key="name" value="tjrq_sntq1" />
      </tag>
      <tag row="1" col="0" colspan="2" rowspan="1" name="MSQL4Select" label="指标">
        <attribute key="isMultiple" value="false" />
        <attribute key="width" value="240px;" />
        <attribute key="isSearch" value="true" />
        <attribute key="sql" value="select khzbdh as KEY,khzbmc as VALUE from khfa_khzb_jg order by zbpx,zbdh" />
        <attribute key="isRequired" value="false" />
        <attribute key="name" value="khzb" />
        <attribute key="isAll" value="false" />
        <attribute key="isEditable" value="true" />
      </tag>
      <tag row="2" col="0" colspan="1" rowspan="1" name="Qxyw" label="业务类别">
        <attribute key="width" value="120px;" />
        <attribute key="editable" value="true" />
        <attribute key="name" value="ywlb" />
        <attribute key="isAll" value="false" />
        <attribute key="multiple" value="false" />
      </tag>
      <tag row="2" col="1" colspan="1" rowspan="1" name="Zb" label="指标">
        <attribute key="parents" value="ywlb" />
        <attribute key="isMultiple" value="false" />
        <attribute key="width" value="120px;" />
        <attribute key="isSearch" value="true" />
        <attribute key="isRequired" value="false" />
        <attribute key="name" value="zbdh" />
        <attribute key="isAll" value="false" />
        <attribute key="isEditable" value="true" />
      </tag>
      <tag row="2" col="2" colspan="1" rowspan="1" name="ZbParam" label="币种">
        <attribute key="parents" value="zbdh" />
        <attribute key="isMultiple" value="false" />
        <attribute key="width" value="100px;" />
        <attribute key="isRequired" value="false" />
        <attribute key="name" value="bz" />
        <attribute key="isAll" value="false" />
        <attribute key="isEditable" value="true" />
        <attribute key="paramType" value="bz" />
      </tag>
      <tag row="2" col="3" colspan="1" rowspan="1" name="ZbParam" label="时段标识">
        <attribute key="parents" value="zbdh" />
        <attribute key="isMultiple" value="false" />
        <attribute key="width" value="80px;" />
        <attribute key="isRequired" value="false" />
        <attribute key="name" value="sdbs" />
        <attribute key="isAll" value="false" />
        <attribute key="isEditable" value="true" />
        <attribute key="paramType" value="sdbs" />
      </tag>
      <tag row="2" col="4" colspan="1" rowspan="1" name="Dmms" label="统计口径">
        <attribute key="width" value="100px;" />
        <attribute key="dmmc" value="tjkj" />
        <attribute key="editable" value="true" />
        <attribute key="name" value="tjkj" />
        <attribute key="isAll" value="false" />
        <attribute key="multiple" value="false" />
      </tag>
      <tag row="2" col="4" colspan="1" rowspan="1" name="Hidden" label="">
        <attribute key="name" value="jzsjy" />
      </tag>
      <tag row="2" col="4" colspan="1" rowspan="1" name="Hidden" label="">
        <attribute key="defVal" value="$sysDate$" />
        <attribute key="name" value="sysDate" />
      </tag>
    </tags>
  </conPart>
  <table id="jgyjbb_xsjy1jgj" title="新数据源1结果集" page="noCount">
    <col id="TJRQ" title="统计日期" align="left" type="string" width="75" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false" />
    <col id="JGDH" title="机构代号" align="left" type="string" width="120" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false" />
    <col id="JGMC" title="机构名称" align="left" type="string" width="150" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false" />
    <col id="ZBMC" title="指标名称" align="left" type="string" width="200" frozen="false" format="" exp="true" zsy="true" showDymCol="true" mergeCells="false" footerCells="false" />
    <col id="BZ" title="币种" align="left" type="string" width="75" frozen="false" format="" exp="true" zsy="true" showDymCol="true" mergeCells="false" footerCells="false" />
    <col id="SDBS" title="时段标识" align="left" type="string" width="75" frozen="false" format="" exp="true" zsy="true" showDymCol="true" mergeCells="false" footerCells="false" />
    <col id="TJKJ" title="统计口径" align="left" type="string" width="75" frozen="false" format="" exp="true" zsy="true" showDymCol="true" mergeCells="false" footerCells="false" />
    <col id="1383881333864" title="比较项" align="left" type="string" width="600" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false">
      <col id="ZBSJ" title="实际值" align="right" type="float" width="120" frozen="false" format="###,##0.00" exp="true" zsy="true" showDymCol="true" mergeCells="false" footerCells="false" />
      <col id="BQNTQ" title="比去年同期" align="right" type="float" width="120" frozen="false" format="###,##0.00" exp="true" zsy="true" showDymCol="true" mergeCells="false" footerCells="false" />
      <col id="BNC" title="比年初" align="right" type="float" width="120" frozen="false" format="###,##0.00" exp="true" zsy="true" showDymCol="true" mergeCells="false" footerCells="false" />
      <col id="BJC" title="比季初" align="right" type="float" width="120" frozen="false" format="###,##0.00" exp="true" zsy="true" showDymCol="true" mergeCells="false" footerCells="false" />
      <col id="BYC" title="比月初" align="right" type="float" width="120" frozen="false" format="###,##0.00" exp="true" zsy="true" showDymCol="true" mergeCells="false" footerCells="false" />
    </col>
  </table>
  <table id="jgyjbb_xsjy2jgj" title="新数据源2结果集" page="noCount">
    <col id="TJRQ" title="统计日期" align="left" type="string" width="75" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false" />
    <col id="JGDH" title="机构代号" align="left" type="string" width="120" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false" />
    <col id="JGMC" title="机构名称" align="left" type="string" width="150" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false" />
    <col id="ZBMC" title="指标名称" align="left" type="string" width="200" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false" />
    <col id="1383881400221" title="比较项" align="left" type="string" width="600" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false">
      <col id="ZBSJ" title="实际值" align="right" type="float" width="120" frozen="false" format="###,##0.00" exp="true" zsy="true" showDymCol="true" mergeCells="false" footerCells="false" />
      <col id="BQNTQ" title="比去年同期" align="right" type="float" width="120" frozen="false" format="###,##0.00" exp="true" zsy="true" showDymCol="true" mergeCells="false" footerCells="false" />
      <col id="BNC" title="比年初" align="right" type="float" width="120" frozen="false" format="###,##0.00" exp="true" zsy="true" showDymCol="true" mergeCells="false" footerCells="false" />
      <col id="BJC" title="比季初" align="right" type="float" width="120" frozen="false" format="###,##0.00" exp="true" zsy="true" showDymCol="true" mergeCells="false" footerCells="false" />
      <col id="BYC" title="比月初" align="right" type="float" width="120" frozen="false" format="###,##0.00" exp="true" zsy="true" showDymCol="true" mergeCells="false" footerCells="false" />
    </col>
  </table>
  <table id="jgyjbb_khzb_tdrjjgj" title="考核指标_特定日期结果集" page="noCount">
    <col id="TJRQ" title="统计日期" align="left" type="string" width="75" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false" />
    <col id="JGDH" title="机构代号" align="left" type="string" width="120" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false" />
    <col id="JGMC" title="机构名称" align="left" type="string" width="150" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false" />
    <col id="ZBMC" title="指标名称" align="left" type="string" width="200" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false" />
    <col id="1459239703274" title="比较项" align="left" type="string" width="600" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false">
      <col id="ZBSJ" title="实际值" align="right" type="float" width="120" frozen="false" format="###,##0.00" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false" />
      <col id="BQNTQ" title="比去年同期" align="right" type="float" width="120" frozen="false" format="###,##0.00" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false" />
      <col id="BNC" title="比年初" align="right" type="float" width="120" frozen="false" format="###,##0.00" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false" />
      <col id="BJC" title="比季初" align="right" type="float" width="120" frozen="false" format="###,##0.00" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false" />
      <col id="BYC" title="比月初" align="right" type="float" width="120" frozen="false" format="###,##0.00" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false" />
    </col>
  </table>
  <table id="jgyjbb_fxzb_tdrjjgj" title="分析指标_特定日期结果集" page="noCount">
    <col id="TJRQ" title="统计日期" align="left" type="string" width="75" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false" />
    <col id="JGDH" title="机构代号" align="left" type="string" width="120" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false" />
    <col id="JGMC" title="机构名称" align="left" type="string" width="150" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false" />
    <col id="ZBMC" title="指标名称" align="left" type="string" width="200" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false" />
    <col id="BZ" title="币种" align="left" type="string" width="75" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false" />
    <col id="SDBS" title="时段标识" align="left" type="string" width="75" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false" />
    <col id="TJKJ" title="统计口径" align="left" type="string" width="75" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false" />
    <col id="1459239841137" title="比较项" align="left" type="string" width="600" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false">
      <col id="ZBSJ" title="实际值" align="right" type="float" width="120" frozen="false" format="###,##0.00" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false" />
      <col id="BQNTQ" title="比去年同期" align="right" type="float" width="120" frozen="false" format="###,##0.00" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false" />
      <col id="BNC" title="比年初" align="right" type="float" width="120" frozen="false" format="###,##0.00" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false" />
      <col id="BJC" title="比季初" align="right" type="float" width="120" frozen="false" format="###,##0.00" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false" />
      <col id="BYC" title="比月初" align="right" type="float" width="120" frozen="false" format="###,##0.00" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false" />
    </col>
  </table>
  <sqlMap namespace="studio.jgyjbb">
    <select id="dn0.jgyjbbList" parameterClass="java.util.Map" resultClass="java.util.HashMap" remapResults="true">
      <isNotEmpty property="db"><![CDATA[/**!mycat:datanode=$db$**/]]></isNotEmpty>
      <isEqual property="jzsjy" compareValue="jgfxzb">
        select s.tjrq, s.jgdh, s.jgmc, s.zbmc, s.zbsj, (s.zbsj - s.qnye) bqntq, (s.zbsj - s.ncye) bnc,  (s.zbsj - s.jcye) bjc, (s.zbsj - s.ycye) byc,  s.bz, s.sdbs, s.tjkj  from (      select jgzb.khdxdh khdxdh, $tjrq$ tjrq, jg.jgdh jgdh,jg.jgmc jgmc, jgfxzb.zbmc zbmc,      coalesce(max(case when jgzb.tjrq = $tjrq$ then jgzb.zbz end), 0) zbsj,      coalesce(max(case when jgzb.tjrq = $tjrq_nc$ then jgzb.zbz end), 0) ncye,      coalesce(max(case when jgzb.tjrq = $tjrq_jc$ then jgzb.zbz end), 0) jcye,      coalesce(max(case when jgzb.tjrq = $tjrq_yc$ then jgzb.zbz end), 0) ycye,      coalesce(max(case when jgzb.tjrq = $tjrq_sntq$ then jgzb.zbz end), 0) qnye ,     bz.bzzwmc as bz, dmms_sdbs.dmms as sdbs, dmms_tjkj.dmms as tjkj      from khdx_zb jgfxzb      inner join (       select khdxdh,tjrq,zbdh,bz,sdbs,tjkj,zbz from yjzb_jg_$tjrq_yyyy$ a
        <isNotEmpty property="jgkhdxdh">where a.khdxdh in ($jgkhdxdh$)</isNotEmpty>
        <isNotEmpty property="zbdh">and a.zbdh = $zbdh$</isNotEmpty>
        <isNotEmpty property="bz">and a.bz = '$bz$'</isNotEmpty>
        <isNotEmpty property="sdbs">and a.sdbs='$sdbs$'</isNotEmpty>
        <isNotEmpty property="tjkj">and a.tjkj='$tjkj$'</isNotEmpty>
        <isNotEmpty property="tjrq">and a.tjrq=$tjrq$</isNotEmpty>
        union all       select khdxdh,tjrq,zbdh,bz,sdbs,tjkj,zbz from yjzb_jg_$tjrq_sntq1$ b
        <isNotEmpty property="jgkhdxdh">where b.khdxdh in ($jgkhdxdh$)</isNotEmpty>
        <isNotEmpty property="zbdh">and b.zbdh = $zbdh$</isNotEmpty>
        <isNotEmpty property="bz">and b.bz = '$bz$'</isNotEmpty>
        <isNotEmpty property="sdbs">and b.sdbs='$sdbs$'</isNotEmpty>
        <isNotEmpty property="tjkj">and b.tjkj='$tjkj$'</isNotEmpty>
        <isNotEmpty property="tjrq_sntq">and b.tjrq=$tjrq_sntq$</isNotEmpty>
        union all       select khdxdh,tjrq,zbdh,bz,sdbs,tjkj,zbz from yjzb_gjyj_jg c        where c.sjwd='3'
        <isNotEmpty property="tjrq_nc">and (c.tjrq = $tjrq_nc$</isNotEmpty>
        or c.tjrq = $tjrq_jc$ or c.tjrq = $tjrq_yc$)
        <isNotEmpty property="jgkhdxdh">and c.khdxdh in ($jgkhdxdh$)</isNotEmpty>
        <isNotEmpty property="zbdh">and c.zbdh = $zbdh$</isNotEmpty>
        <isNotEmpty property="bz">and c.bz = '$bz$'</isNotEmpty>
        <isNotEmpty property="sdbs">and c.sdbs='$sdbs$'</isNotEmpty>
        <isNotEmpty property="tjkj">and c.tjkj='$tjkj$'</isNotEmpty>
        ) jgzb on jgfxzb.zbdh = jgzb.zbdh      inner join csb_dmms dmms_sdbs on dmms_sdbs.dmz = jgzb.sdbs and dmms_sdbs.dmmc = 'ZBSDBS'      inner join csb_dmms dmms_tjkj on dmms_tjkj.dmz = jgzb.tjkj and dmms_tjkj.dmmc = 'TJKJ'      inner join csb_bz bz on bz.bz = jgzb.bz      inner join khdx_jg jg on jgzb.khdxdh = jg.khdxdh
        <isNotEmpty property="jgdj">and jg.jgdj='$jgdj$'</isNotEmpty>
        group by jgzb.khdxdh, jg.jgdh, jg.jgmc, jgfxzb.zbmc , bz.bzzwmc , dmms_sdbs.dmms, dmms_tjkj.dmms  ) s order by zbsj desc,jgdh asc
      </isEqual>
      <isEqual property="jzsjy" compareValue="jgkhzb">
        select s.tjrq, s.jgdh, s.jgmc, s.zbmc, s.zbsj, (s.zbsj - s.qnye) bqntq, (s.zbsj - s.ncye) bnc, (s.zbsj - s.jcye) bjc, (s.zbsj - s.ycye) byc  from (      select jgzb.khdxdh khdxdh, $tjrq$  tjrq, jg.jgdh jgdh, jg.jgmc jgmc, jgzb.khzbmc zbmc,      coalesce(max(case when jgzb.tjrq = $tjrq$ then jgzb.zbz end), 0) zbsj,     coalesce(max(case when jgzb.tjrq = $tjrq_nc$ then jgzb.zbz end), 0) ncye,      coalesce(max(case when jgzb.tjrq = $tjrq_jc$ then jgzb.zbz end), 0) jcye,     coalesce(max(case when jgzb.tjrq = $tjrq_yc$ then jgzb.zbz end), 0) ycye,     coalesce(max(case when jgzb.tjrq = $tjrq_sntq$ then jgzb.zbz end), 0) qnye      from (       select khdxdh,tjrq,zbz,khzbmc from yjzb_jg_$tjrq_yyyy$ a       inner join khfa_khzb_jg jgkhzb on jgkhzb.zbdh = a.zbdh
        <isNotEmpty property="khzb">and jgkhzb.khzbdh = $khzb$</isNotEmpty>
        and jgkhzb.sdbs = a.sdbs and jgkhzb.tjkj = a.tjkj and jgkhzb.bz = a.bz
        <isNotEmpty property="jgkhdxdh">where a.khdxdh in ($jgkhdxdh$)</isNotEmpty>
        <isNotEmpty property="tjrq">and a.tjrq=$tjrq$</isNotEmpty>
        union all       select khdxdh,tjrq,zbz,khzbmc from yjzb_jg_$tjrq_sntq1$ b       inner join khfa_khzb_jg jgkhzb on jgkhzb.zbdh = b.zbdh
        <isNotEmpty property="khzb">and jgkhzb.khzbdh = $khzb$</isNotEmpty>
        and jgkhzb.sdbs = b.sdbs and jgkhzb.tjkj = b.tjkj and jgkhzb.bz = b.bz
        <isNotEmpty property="jgkhdxdh">where b.khdxdh in ($jgkhdxdh$)</isNotEmpty>
        <isNotEmpty property="tjrq_sntq">and b.tjrq=$tjrq_sntq$</isNotEmpty>
        union all       select khdxdh,tjrq,zbz,khzbmc from yjzb_gjyj_jg c        inner join khfa_khzb_jg jgkhzb on jgkhzb.zbdh = c.zbdh
        <isNotEmpty property="khzb">and jgkhzb.khzbdh = $khzb$</isNotEmpty>
        and jgkhzb.sdbs = c.sdbs and jgkhzb.tjkj = c.tjkj and jgkhzb.bz = c.bz       where c.sjwd='3'
        <isNotEmpty property="tjrq_nc">and (c.tjrq = $tjrq_nc$</isNotEmpty>
        or c.tjrq = $tjrq_jc$ or c.tjrq = $tjrq_yc$)
        <isNotEmpty property="jgkhdxdh">and c.khdxdh in ($jgkhdxdh$)</isNotEmpty>
        ) jgzb       inner join khdx_jg jg on jgzb.khdxdh = jg.khdxdh
        <isNotEmpty property="jgdj">and jg.jgdj='$jgdj$'</isNotEmpty>
        group by jgzb.khdxdh, jg.jgdh, jg.jgmc, jgzb.khzbmc  ) s order by zbsj desc,jgdh asc
      </isEqual>
      <isEqual property="jzsjy" compareValue="gjyjkhzb">
        select s.tjrq, s.jgdh, s.jgmc, s.zbmc, s.zbsj, (s.zbsj - s.qnye) bqntq, (s.zbsj - s.ncye) bnc, (s.zbsj - s.jcye) bjc, (s.zbsj - s.ycye) byc  from (      select jgzb.khdxdh khdxdh, $tjrq$  tjrq, jg.jgdh jgdh, jg.jgmc jgmc, jgkhzb.khzbmc zbmc,      coalesce(max(case when jgzb.tjrq = $tjrq$ then jgzb.zbz end), 0) zbsj,     coalesce(max(case when jgzb.tjrq = $tjrq_nc$ then jgzb.zbz end), 0) ncye,      coalesce(max(case when jgzb.tjrq = $tjrq_jc$ then jgzb.zbz end), 0) jcye,     coalesce(max(case when jgzb.tjrq = $tjrq_yc$ then jgzb.zbz end), 0) ycye,     coalesce(max(case when jgzb.tjrq = $tjrq_sntq$ then jgzb.zbz end), 0) qnye      from khfa_khzb_jg jgkhzb      inner join yjzb_gjyj_jg jgzb on jgkhzb.zbdh = jgzb.zbdh and jgkhzb.sdbs = jgzb.sdbs and jgkhzb.tjkj = jgzb.tjkj and jgkhzb.bz = jgzb.bz      inner join khdx_jg jg on jgzb.khdxdh = jg.khdxdh
        <isNotEmpty property="jgdj">and jg.jgdj='$jgdj$'</isNotEmpty>
        <isNotEmpty property="jgkhdxdh">where jg.khdxdh in ($jgkhdxdh$)</isNotEmpty>
        <isNotEmpty property="khzb">and jgkhzb.khzbdh = $khzb$</isNotEmpty>
        and jgzb.tjrq in($tjrq$,$tjrq_nc$,$tjrq_jc$,$tjrq_yc$,$tjrq_sntq$)     and jgzb.sjwd in('2','3')     group by jgzb.khdxdh, jg.jgdh, jg.jgmc, jgkhzb.khzbmc  ) s order by zbsj desc,jgdh asc
      </isEqual>
      <isEqual property="jzsjy" compareValue="gjyjfxzb">
        select s.tjrq, s.jgdh, s.jgmc, s.zbmc, s.zbsj, (s.zbsj - s.qnye) bqntq, (s.zbsj - s.ncye) bnc,  (s.zbsj - s.jcye) bjc, (s.zbsj - s.ycye) byc,  s.bz, s.sdbs, s.tjkj  from (      select jgzb.khdxdh khdxdh, $tjrq$ tjrq, jg.jgdh jgdh,jg.jgmc jgmc, jgfxzb.zbmc zbmc,      coalesce(max(case when jgzb.tjrq = $tjrq$ then jgzb.zbz end), 0) zbsj,      coalesce(max(case when jgzb.tjrq = $tjrq_nc$ then jgzb.zbz end), 0) ncye,      coalesce(max(case when jgzb.tjrq = $tjrq_jc$ then jgzb.zbz end), 0) jcye,      coalesce(max(case when jgzb.tjrq = $tjrq_yc$ then jgzb.zbz end), 0) ycye,      coalesce(max(case when jgzb.tjrq = $tjrq_sntq$ then jgzb.zbz end), 0) qnye ,     bz.bzzwmc as bz, dmms_sdbs.dmms as sdbs, dmms_tjkj.dmms as tjkj      from khdx_zb jgfxzb      inner join yjzb_gjyj_jg jgzb on jgfxzb.zbdh = jgzb.zbdh
        <isNotEmpty property="bz">and jgzb.bz = '$bz$'</isNotEmpty>
        <isNotEmpty property="sdbs">and jgzb.sdbs='$sdbs$'</isNotEmpty>
        <isNotEmpty property="tjkj">and jgzb.tjkj='$tjkj$'</isNotEmpty>
        inner join csb_dmms dmms_sdbs on dmms_sdbs.dmz = jgzb.sdbs and dmms_sdbs.dmmc = 'ZBSDBS'      inner join csb_dmms dmms_tjkj on dmms_tjkj.dmz = jgzb.tjkj and dmms_tjkj.dmmc = 'TJKJ'      inner join csb_bz bz on bz.bz = jgzb.bz      inner join khdx_jg jg on jgzb.khdxdh = jg.khdxdh
        <isNotEmpty property="jgdj">and jg.jgdj='$jgdj$'</isNotEmpty>
        inner join khdx_zb zb on jgzb.zbdh = zb.zbdh
        <isNotEmpty property="jgkhdxdh">where jg.khdxdh in ($jgkhdxdh$)</isNotEmpty>
        <isNotEmpty property="zbdh">and jgfxzb.zbdh = $zbdh$</isNotEmpty>
        and jgzb.tjrq in($tjrq$,$tjrq_nc$,$tjrq_jc$,$tjrq_yc$,$tjrq_sntq$)     and jgzb.sjwd in('2','3')     group by jgzb.khdxdh, jg.jgdh, jg.jgmc, jgfxzb.zbmc , bz.bzzwmc , dmms_sdbs.dmms, dmms_tjkj.dmms  ) s order by zbsj desc,jgdh asc
      </isEqual>
    </select>
    <select id="dn0.jgyjbbCount" parameterClass="java.util.Map" resultClass="java.lang.Integer">
      <isNotEmpty property="db"><![CDATA[/**!mycat:datanode=$db$**/]]></isNotEmpty>
      select count(1) from (
      <isEqual property="jzsjy" compareValue="jgfxzb">
        select s.tjrq, s.jgdh, s.jgmc, s.zbmc, s.zbsj, (s.zbsj - s.qnye) bqntq, (s.zbsj - s.ncye) bnc,  (s.zbsj - s.jcye) bjc, (s.zbsj - s.ycye) byc,  s.bz, s.sdbs, s.tjkj  from (      select jgzb.khdxdh khdxdh, $tjrq$ tjrq, jg.jgdh jgdh,jg.jgmc jgmc, jgfxzb.zbmc zbmc,      coalesce(max(case when jgzb.tjrq = $tjrq$ then jgzb.zbz end), 0) zbsj,      coalesce(max(case when jgzb.tjrq = $tjrq_nc$ then jgzb.zbz end), 0) ncye,      coalesce(max(case when jgzb.tjrq = $tjrq_jc$ then jgzb.zbz end), 0) jcye,      coalesce(max(case when jgzb.tjrq = $tjrq_yc$ then jgzb.zbz end), 0) ycye,      coalesce(max(case when jgzb.tjrq = $tjrq_sntq$ then jgzb.zbz end), 0) qnye ,     bz.bzzwmc as bz, dmms_sdbs.dmms as sdbs, dmms_tjkj.dmms as tjkj      from khdx_zb jgfxzb      inner join (       select khdxdh,tjrq,zbdh,bz,sdbs,tjkj,zbz from yjzb_jg_$tjrq_yyyy$ a
        <isNotEmpty property="jgkhdxdh">where a.khdxdh in ($jgkhdxdh$)</isNotEmpty>
        <isNotEmpty property="zbdh">and a.zbdh = $zbdh$</isNotEmpty>
        <isNotEmpty property="bz">and a.bz = '$bz$'</isNotEmpty>
        <isNotEmpty property="sdbs">and a.sdbs='$sdbs$'</isNotEmpty>
        <isNotEmpty property="tjkj">and a.tjkj='$tjkj$'</isNotEmpty>
        <isNotEmpty property="tjrq">and a.tjrq=$tjrq$</isNotEmpty>
        union all       select khdxdh,tjrq,zbdh,bz,sdbs,tjkj,zbz from yjzb_jg_$tjrq_sntq1$ b
        <isNotEmpty property="jgkhdxdh">where b.khdxdh in ($jgkhdxdh$)</isNotEmpty>
        <isNotEmpty property="zbdh">and b.zbdh = $zbdh$</isNotEmpty>
        <isNotEmpty property="bz">and b.bz = '$bz$'</isNotEmpty>
        <isNotEmpty property="sdbs">and b.sdbs='$sdbs$'</isNotEmpty>
        <isNotEmpty property="tjkj">and b.tjkj='$tjkj$'</isNotEmpty>
        <isNotEmpty property="tjrq_sntq">and b.tjrq=$tjrq_sntq$</isNotEmpty>
        union all       select khdxdh,tjrq,zbdh,bz,sdbs,tjkj,zbz from yjzb_gjyj_jg c        where c.sjwd='3'
        <isNotEmpty property="tjrq_nc">and (c.tjrq = $tjrq_nc$</isNotEmpty>
        or c.tjrq = $tjrq_jc$ or c.tjrq = $tjrq_yc$)
        <isNotEmpty property="jgkhdxdh">and c.khdxdh in ($jgkhdxdh$)</isNotEmpty>
        <isNotEmpty property="zbdh">and c.zbdh = $zbdh$</isNotEmpty>
        <isNotEmpty property="bz">and c.bz = '$bz$'</isNotEmpty>
        <isNotEmpty property="sdbs">and c.sdbs='$sdbs$'</isNotEmpty>
        <isNotEmpty property="tjkj">and c.tjkj='$tjkj$'</isNotEmpty>
        ) jgzb on jgfxzb.zbdh = jgzb.zbdh      inner join csb_dmms dmms_sdbs on dmms_sdbs.dmz = jgzb.sdbs and dmms_sdbs.dmmc = 'ZBSDBS'      inner join csb_dmms dmms_tjkj on dmms_tjkj.dmz = jgzb.tjkj and dmms_tjkj.dmmc = 'TJKJ'      inner join csb_bz bz on bz.bz = jgzb.bz      inner join khdx_jg jg on jgzb.khdxdh = jg.khdxdh
        <isNotEmpty property="jgdj">and jg.jgdj='$jgdj$'</isNotEmpty>
        group by jgzb.khdxdh, jg.jgdh, jg.jgmc, jgfxzb.zbmc , bz.bzzwmc , dmms_sdbs.dmms, dmms_tjkj.dmms  ) s order by zbsj desc,jgdh asc
      </isEqual>
      <isEqual property="jzsjy" compareValue="jgkhzb">
        select s.tjrq, s.jgdh, s.jgmc, s.zbmc, s.zbsj, (s.zbsj - s.qnye) bqntq, (s.zbsj - s.ncye) bnc, (s.zbsj - s.jcye) bjc, (s.zbsj - s.ycye) byc  from (      select jgzb.khdxdh khdxdh, $tjrq$  tjrq, jg.jgdh jgdh, jg.jgmc jgmc, jgzb.khzbmc zbmc,      coalesce(max(case when jgzb.tjrq = $tjrq$ then jgzb.zbz end), 0) zbsj,     coalesce(max(case when jgzb.tjrq = $tjrq_nc$ then jgzb.zbz end), 0) ncye,      coalesce(max(case when jgzb.tjrq = $tjrq_jc$ then jgzb.zbz end), 0) jcye,     coalesce(max(case when jgzb.tjrq = $tjrq_yc$ then jgzb.zbz end), 0) ycye,     coalesce(max(case when jgzb.tjrq = $tjrq_sntq$ then jgzb.zbz end), 0) qnye      from (       select khdxdh,tjrq,zbz,khzbmc from yjzb_jg_$tjrq_yyyy$ a       inner join khfa_khzb_jg jgkhzb on jgkhzb.zbdh = a.zbdh
        <isNotEmpty property="khzb">and jgkhzb.khzbdh = $khzb$</isNotEmpty>
        and jgkhzb.sdbs = a.sdbs and jgkhzb.tjkj = a.tjkj and jgkhzb.bz = a.bz
        <isNotEmpty property="jgkhdxdh">where a.khdxdh in ($jgkhdxdh$)</isNotEmpty>
        <isNotEmpty property="tjrq">and a.tjrq=$tjrq$</isNotEmpty>
        union all       select khdxdh,tjrq,zbz,khzbmc from yjzb_jg_$tjrq_sntq1$ b       inner join khfa_khzb_jg jgkhzb on jgkhzb.zbdh = b.zbdh
        <isNotEmpty property="khzb">and jgkhzb.khzbdh = $khzb$</isNotEmpty>
        and jgkhzb.sdbs = b.sdbs and jgkhzb.tjkj = b.tjkj and jgkhzb.bz = b.bz
        <isNotEmpty property="jgkhdxdh">where b.khdxdh in ($jgkhdxdh$)</isNotEmpty>
        <isNotEmpty property="tjrq_sntq">and b.tjrq=$tjrq_sntq$</isNotEmpty>
        union all       select khdxdh,tjrq,zbz,khzbmc from yjzb_gjyj_jg c        inner join khfa_khzb_jg jgkhzb on jgkhzb.zbdh = c.zbdh
        <isNotEmpty property="khzb">and jgkhzb.khzbdh = $khzb$</isNotEmpty>
        and jgkhzb.sdbs = c.sdbs and jgkhzb.tjkj = c.tjkj and jgkhzb.bz = c.bz       where c.sjwd='3'
        <isNotEmpty property="tjrq_nc">and (c.tjrq = $tjrq_nc$</isNotEmpty>
        or c.tjrq = $tjrq_jc$ or c.tjrq = $tjrq_yc$)
        <isNotEmpty property="jgkhdxdh">and c.khdxdh in ($jgkhdxdh$)</isNotEmpty>
        ) jgzb       inner join khdx_jg jg on jgzb.khdxdh = jg.khdxdh
        <isNotEmpty property="jgdj">and jg.jgdj='$jgdj$'</isNotEmpty>
        group by jgzb.khdxdh, jg.jgdh, jg.jgmc, jgzb.khzbmc  ) s order by zbsj desc,jgdh asc
      </isEqual>
      <isEqual property="jzsjy" compareValue="gjyjkhzb">
        select s.tjrq, s.jgdh, s.jgmc, s.zbmc, s.zbsj, (s.zbsj - s.qnye) bqntq, (s.zbsj - s.ncye) bnc, (s.zbsj - s.jcye) bjc, (s.zbsj - s.ycye) byc  from (      select jgzb.khdxdh khdxdh, $tjrq$  tjrq, jg.jgdh jgdh, jg.jgmc jgmc, jgkhzb.khzbmc zbmc,      coalesce(max(case when jgzb.tjrq = $tjrq$ then jgzb.zbz end), 0) zbsj,     coalesce(max(case when jgzb.tjrq = $tjrq_nc$ then jgzb.zbz end), 0) ncye,      coalesce(max(case when jgzb.tjrq = $tjrq_jc$ then jgzb.zbz end), 0) jcye,     coalesce(max(case when jgzb.tjrq = $tjrq_yc$ then jgzb.zbz end), 0) ycye,     coalesce(max(case when jgzb.tjrq = $tjrq_sntq$ then jgzb.zbz end), 0) qnye      from khfa_khzb_jg jgkhzb      inner join yjzb_gjyj_jg jgzb on jgkhzb.zbdh = jgzb.zbdh and jgkhzb.sdbs = jgzb.sdbs and jgkhzb.tjkj = jgzb.tjkj and jgkhzb.bz = jgzb.bz      inner join khdx_jg jg on jgzb.khdxdh = jg.khdxdh
        <isNotEmpty property="jgdj">and jg.jgdj='$jgdj$'</isNotEmpty>
        <isNotEmpty property="jgkhdxdh">where jg.khdxdh in ($jgkhdxdh$)</isNotEmpty>
        <isNotEmpty property="khzb">and jgkhzb.khzbdh = $khzb$</isNotEmpty>
        and jgzb.tjrq in($tjrq$,$tjrq_nc$,$tjrq_jc$,$tjrq_yc$,$tjrq_sntq$)     and jgzb.sjwd in('2','3')     group by jgzb.khdxdh, jg.jgdh, jg.jgmc, jgkhzb.khzbmc  ) s order by zbsj desc,jgdh asc
      </isEqual>
      <isEqual property="jzsjy" compareValue="gjyjfxzb">
        select s.tjrq, s.jgdh, s.jgmc, s.zbmc, s.zbsj, (s.zbsj - s.qnye) bqntq, (s.zbsj - s.ncye) bnc,  (s.zbsj - s.jcye) bjc, (s.zbsj - s.ycye) byc,  s.bz, s.sdbs, s.tjkj  from (      select jgzb.khdxdh khdxdh, $tjrq$ tjrq, jg.jgdh jgdh,jg.jgmc jgmc, jgfxzb.zbmc zbmc,      coalesce(max(case when jgzb.tjrq = $tjrq$ then jgzb.zbz end), 0) zbsj,      coalesce(max(case when jgzb.tjrq = $tjrq_nc$ then jgzb.zbz end), 0) ncye,      coalesce(max(case when jgzb.tjrq = $tjrq_jc$ then jgzb.zbz end), 0) jcye,      coalesce(max(case when jgzb.tjrq = $tjrq_yc$ then jgzb.zbz end), 0) ycye,      coalesce(max(case when jgzb.tjrq = $tjrq_sntq$ then jgzb.zbz end), 0) qnye ,     bz.bzzwmc as bz, dmms_sdbs.dmms as sdbs, dmms_tjkj.dmms as tjkj      from khdx_zb jgfxzb      inner join yjzb_gjyj_jg jgzb on jgfxzb.zbdh = jgzb.zbdh
        <isNotEmpty property="bz">and jgzb.bz = '$bz$'</isNotEmpty>
        <isNotEmpty property="sdbs">and jgzb.sdbs='$sdbs$'</isNotEmpty>
        <isNotEmpty property="tjkj">and jgzb.tjkj='$tjkj$'</isNotEmpty>
        inner join csb_dmms dmms_sdbs on dmms_sdbs.dmz = jgzb.sdbs and dmms_sdbs.dmmc = 'ZBSDBS'      inner join csb_dmms dmms_tjkj on dmms_tjkj.dmz = jgzb.tjkj and dmms_tjkj.dmmc = 'TJKJ'      inner join csb_bz bz on bz.bz = jgzb.bz      inner join khdx_jg jg on jgzb.khdxdh = jg.khdxdh
        <isNotEmpty property="jgdj">and jg.jgdj='$jgdj$'</isNotEmpty>
        inner join khdx_zb zb on jgzb.zbdh = zb.zbdh
        <isNotEmpty property="jgkhdxdh">where jg.khdxdh in ($jgkhdxdh$)</isNotEmpty>
        <isNotEmpty property="zbdh">and jgfxzb.zbdh = $zbdh$</isNotEmpty>
        and jgzb.tjrq in($tjrq$,$tjrq_nc$,$tjrq_jc$,$tjrq_yc$,$tjrq_sntq$)     and jgzb.sjwd in('2','3')     group by jgzb.khdxdh, jg.jgdh, jg.jgmc, jgfxzb.zbmc , bz.bzzwmc , dmms_sdbs.dmms, dmms_tjkj.dmms  ) s order by zbsj desc,jgdh asc
      </isEqual>
      ) t
    </select>
    <select id="dn0.jgyjbb_MSQL4SELECT_khzb" parameterClass="java.util.Map" resultClass="java.util.HashMap" remapResults="true">/**!mycat:datanode=$db$**/ select khzbdh as KEY,khzbmc as VALUE from khfa_khzb_jg order by zbpx,zbdh</select>
  </sqlMap>
  <rels>
    <items id="jgyjbb_xsjy1jgj">
      <item name="jzsjy" compareValue="jgfxzb" operate="isEqual" />
    </items>
    <items id="jgyjbb_xsjy2jgj">
      <item name="jzsjy" compareValue="jgkhzb" operate="isEqual" />
    </items>
    <items id="jgyjbb_khzb_tdrjjgj">
      <item name="jzsjy" compareValue="gjyjkhzb" operate="isEqual" />
    </items>
    <items id="jgyjbb_fxzb_tdrjjgj">
      <item name="jzsjy" compareValue="gjyjfxzb" operate="isEqual" />
    </items>
  </rels>
  <javascript><![CDATA[jQuery(document).ready(function () {
  /*var year = $('#tjrq').val().substring(0,4);
  var month = $('#tjrq').val().substring(4,6);
  var data = $('#tjrq').val().substring(6,8);
  var d = new Date(year+"/"+month+"/"+data);
  d.setDate(d.getDate()-7);
  var months = d.getMonth()+1;
  var days = d.getDate();
  if(months<10){months=0+""+months;}
  if(days<10){days=0+""+days;}
  $('#tjrq').val(d.getFullYear()+""+months+""+days);*/
  
  $('#khzb').hide();
  init_yjlx().pipe(function(){
    jQuery('#yjlx').bind('change',yjlxChange).trigger('change');
    $('#tjrq').bind('blur',getQnrq).trigger('blur');
  });
  
  $("#query_table tr:eq(1)").append($("<td></td>").append($(".operation[value='查 询']")));
  $("#tjkj option").each(function(){
    if($(this).val()==2)
      $(this).remove();
  });
});

function getQnrq(){
  //alert('change');
}

//自定义验证，在提交时执行。通过返回true，否则返回false
function customValidate(){
  createTime(jQuery('#tjrq'),jQuery('#myForm'));
  tjrqChange();
  $('#tjrq_sntq1').val(parseInt($('#tjrq').val().substr(0,4))-1);
  return true;
}

function changeZbType(){
      var value = jQuery(this).val();
      jQuery('#khzb').hide();
      jQuery('#fxzb').hide();
      jQuery('#'+value).show();
}


function yjlxChange(){
var yjlx = jQuery('#yjlx');
var khzb = jQuery('#khzb');
  if(yjlx.val()=='fxzb'){
    khzb.hide();
    khzb.parent().prev().hide();
    khzb.parent().hide();
    
    $("#ywlb").show();
     $("#zbdh").show();
     $("#sdbs").show();
     $("#tjkj").show();
     $("#bz").show();
     $("#ywlb").parent().prev().show();
     $("#zbdh").parent().prev().show();
     $("#zbdh").parent().show();
     $("#sdbs").parent().prev().show();
     $("#tjkj").parent().prev().show();
     $("#bz").parent().prev().show();
    
    
  }else{
    khzb.show();
     khzb.parent().prev().show();
     khzb.parent().show();
    
    $("#ywlb").hide();
     $("#zbdh").hide();
     $("#sdbs").hide();
     $("#tjkj").hide();
     $("#bz").hide();
     $("#ywlb").parent().prev().hide();
     $("#zbdh").parent().prev().hide();
     $("#zbdh").parent().hide();
     $("#sdbs").parent().prev().hide();
     $("#tjkj").parent().prev().hide();
     $("#bz").parent().prev().hide();
    
  }
}

function tjrqChange(){
  //起始日期为当前日期的前1天
  var sysdate = jQuery('#sysDate').val(); 
  var o_yf = createTimeObj($("#tjrq").val());
  var ym = o_yf.ym;//月末
  var yc = o_yf.yc;//月初
  if($('#tjrq').val()==yc || $('#tjrq').val()==ym){
    if($('#yjlx').val()=='fxzb'){
      $('#jzsjy').val('gjyjfxzb');
    }else{
      $('#jzsjy').val('gjyjkhzb');
    }
  }else{
    if($('#yjlx').val()=='fxzb'){
      $('#jzsjy').val('jgfxzb');
    }else{
      $('#jzsjy').val('jgkhzb');
    }
  }
}

//日期加减函数
function dayAdd(myTjrq,num){
  var myDate=new Date(myTjrq.substring(0,4) + '-' + myTjrq.substring(4,6) + '-' + myTjrq.substring(6,8));
  var reDate=new Date(Date.parse(myDate) + (86400000 * num))
  var year  = reDate.getFullYear();
  var month = reDate.getMonth()+1;
  var day   = reDate.getDate();
  if(month<10){month=0+""+month;}
  if(day<10){day=0+""+day;}
  return year+""+month+""+day;
}]]></javascript>
</pageSetting>

