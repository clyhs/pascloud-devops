<?xml version="1.0" encoding="UTF-8"?>

<pageSetting id="dktjrgl" title="贷款推荐人管理" type="manage" version="1.0.0.0" pid="" desc="标准版"> 
  <conPart> 
    <tags> 
      <tag row="0" col="0" rowspan="1" colspan="1" name="Text" label="贷款账号" fieldName=""> 
        <attribute key="style" value="width:200px"/>  
        <attribute key="name" value="dkzh"/>  
        <attribute key="readonly" value="false"/>  
        <attribute key="editable" value="true"/> 
      </tag>  
      <tag row="0" col="1" rowspan="1" colspan="1" name="Hidden" label="" fieldName=""> 
        <attribute key="defVal" value="$csDate$"/>  
        <attribute key="name" value="csrq"/> 
      </tag> 
    </tags> 
  </conPart>  
  <table page="true" id="dktjrgltable"> 
    <col id="ZHDH" title="账号" align="left" type="string" width="180" format="" frozen="false" mergeCells="false" footerCells="false" exp="true" zsy="true" showDymCol="false"/>  
    <col id="ZHHM" title="账户名称" align="left" type="string" width="120" format="" frozen="false" mergeCells="false" footerCells="false" exp="true" zsy="true" showDymCol="false"/>  
    <col id="" title="推荐人1" align="left" type="string" width="235" format="" frozen="false" mergeCells="false" footerCells="false" exp="true" zsy="true" showDymCol="false"> 
      <col id="TJR1" title="行员代号" align="left" type="string" width="75" format="" frozen="" mergeCells="" footerCells="" exp="true" zsy="true" showDymCol="false"/>  
      <col id="TJR1MC" title="行员名称" align="left" type="string" width="75" format="" frozen="" mergeCells="" footerCells="" exp="true" zsy="true" showDymCol="false"/>  
      <col id="TJR1FPBL" title="分配比例（%）" align="right" type="float" width="85" format="" frozen="" mergeCells="" footerCells="" exp="true" zsy="true" showDymCol="false"/> 
    </col>  
    <col id="" title="推荐人2" align="left" type="string" width="235" format="" frozen="false" mergeCells="false" footerCells="false" exp="true" zsy="true" showDymCol="false"> 
      <col id="TJR2" title="行员代号" align="left" type="string" width="75" format="" frozen="" mergeCells="" footerCells="" exp="true" zsy="true" showDymCol="false"/>  
      <col id="TJR2MC" title="行员名称" align="left" type="string" width="75" format="" frozen="" mergeCells="" footerCells="" exp="true" zsy="true" showDymCol="false"/>  
      <col id="TJR2FPBL" title="分配比例（%）" align="right" type="float" width="85" format="" frozen="" mergeCells="" footerCells="" exp="true" zsy="true" showDymCol="false"/> 
    </col>  
    <col id="BZSM" title="备注说明" align="left" type="string" width="200" format="" frozen="false" mergeCells="false" footerCells="false" exp="true" zsy="true" showDymCol="false"/>  
    <col id="JXDXDH" title="绩效对象代号" align="left" type="hidden" width="120" format="" frozen="false" mergeCells="false" footerCells="false" exp="true" zsy="true" showDymCol="false"/>  
    <col id="TJRKHDXDH1" title="TJRKHDXDH1" align="left" type="hidden" width="120" format="" frozen="false" mergeCells="false" footerCells="false" exp="true" zsy="true" showDymCol="false"/>  
    <col id="TJRKHDXDH2" title="TJRKHDXDH2" align="left" type="hidden" width="120" format="" frozen="false" mergeCells="false" footerCells="false" exp="true" zsy="true" showDymCol="false"/> 
  </table>  
  <rels> 
    <items id="dktjrgltable"/> 
  </rels>  
  <addPage title="编辑页面"> 
    <tag row="0" col="0" rowspan="1" colspan="2" name="Text" label="贷款账户" fieldName=""> 
      <attribute key="style" value="width:354px;"/>  
      <attribute key="name" value="zhdh"/>  
      <attribute key="styleClass" value="required"/>  
      <attribute key="readonly" value="false"/>  
      <attribute key="editable" value="true"/> 
    </tag>  
    <tag row="1" col="0" rowspan="1" colspan="1" name="NewMultipleHy" label="推荐人1" fieldName=""> 
      <attribute key="isRequired" value="true"/>  
      <attribute key="style" value="width:115px;"/>  
      <attribute key="isDisplayXN" value="true"/>  
      <attribute key="jgckbz" value="jg_ckhy"/>  
      <attribute key="name" value="tjrkhdxdh1"/>  
      <attribute key="multiple" value="false"/>  
      <attribute key="editable" value="true"/> 
    </tag>  
    <tag row="1" col="1" rowspan="1" colspan="1" name="Number" label="分配比例(单位:%)" fieldName="TJR1FPBL"> 
      <attribute key="precision" value="2"/>  
      <attribute key="style" value="width:110px;"/>  
      <attribute key="defVal" value="0"/>  
      <attribute key="name" value="tjr1fpbl"/>  
      <attribute key="intparts" value="4"/>  
      <attribute key="readonly" value="false"/>  
      <attribute key="editable" value="true"/> 
    </tag>  
    <tag row="2" col="0" rowspan="1" colspan="1" name="NewMultipleHy" label="推荐人2" fieldName=""> 
      <attribute key="isRequired" value="false"/>  
      <attribute key="style" value="width:115px;"/>  
      <attribute key="isDisplayXN" value="true"/>  
      <attribute key="jgckbz" value="jg_ckhy"/>  
      <attribute key="name" value="tjrkhdxdh2"/>  
      <attribute key="multiple" value="false"/>  
      <attribute key="editable" value="true"/> 
    </tag>  
    <tag row="2" col="1" rowspan="1" colspan="1" name="Number" label="分配比例(单位:%)" fieldName="TJR2FPBL"> 
      <attribute key="precision" value="2"/>  
      <attribute key="style" value="width:110px;"/>  
      <attribute key="defVal" value="0"/>  
      <attribute key="name" value="tjr2fpbl"/>  
      <attribute key="intparts" value="4"/>  
      <attribute key="readonly" value="false"/>  
      <attribute key="editable" value="true"/> 
    </tag>  
    <tag row="3" col="0" rowspan="1" colspan="2" name="Textarea" label="备注说明" fieldName="BZSM"> 
      <attribute key="cols" value="30"/>  
      <attribute key="style" value="width:354px;"/>  
      <attribute key="name" value="bzsm"/>  
      <attribute key="styleClass" value="{maxlength:100}"/>  
      <attribute key="readonly" value="false"/>  
      <attribute key="editable" value="true"/>  
      <attribute key="rows" value="4"/> 
    </tag>  
    <tag row="4" col="0" rowspan="1" colspan="1" name="Hidden" label="" fieldName="CZR"> 
      <attribute key="defVal" value="$login_hydh$"/>  
      <attribute key="name" value="czr"/> 
    </tag>  
    <tag row="4" col="1" rowspan="1" colspan="1" name="Hidden" label="" fieldName="TJR2"> 
      <attribute key="name" value="tjr2"/> 
    </tag>  
    <tag row="5" col="0" rowspan="1" colspan="1" name="Hidden" label="" fieldName="CZSJ"> 
      <attribute key="defVal" value="systime"/>  
      <attribute key="name" value="czsj"/> 
    </tag>  
    <tag row="5" col="1" rowspan="1" colspan="1" name="DataInterface" label="null" fieldName=""> 
      <attribute key="dataType" value="select"/>  
      <attribute key="sql" value="select jxdxdh from jxdx_dkzh where zhdh='$zhdh$'"/>  
      <attribute key="name" value="getzh"/> 
    </tag>  
    <tag row="6" col="0" rowspan="1" colspan="1" name="Hidden" label="" fieldName="JXDXDH"> 
      <attribute key="name" value="jxdxdh"/> 
    </tag>  
    <tag row="6" col="1" rowspan="1" colspan="1" name="Hidden" label="" fieldName="TJR1"> 
      <attribute key="name" value="tjr1"/> 
    </tag> 
  </addPage>  
  <updatePage title="编辑页面"> 
    <tag row="0" col="0" rowspan="1" colspan="2" name="Text" label="贷款账户" fieldName=""> 
      <attribute key="style" value="width:354px;"/>  
      <attribute key="name" value="zhdh"/>  
      <attribute key="styleClass" value="required"/>  
      <attribute key="readonly" value="false"/>  
      <attribute key="editable" value="true"/> 
    </tag>  
    <tag row="1" col="0" rowspan="1" colspan="1" name="NewMultipleHy" label="推荐人1" fieldName=""> 
      <attribute key="isRequired" value="true"/>  
      <attribute key="style" value="width:115px;"/>  
      <attribute key="isDisplayXN" value="true"/>  
      <attribute key="jgckbz" value="jg_ckhy"/>  
      <attribute key="name" value="tjrkhdxdh1"/>  
      <attribute key="multiple" value="false"/>  
      <attribute key="editable" value="true"/> 
    </tag>  
    <tag row="1" col="1" rowspan="1" colspan="1" name="Number" label="分配比例(单位:%)" fieldName="TJR1FPBL"> 
      <attribute key="precision" value="2"/>  
      <attribute key="style" value="width:110px;"/>  
      <attribute key="defVal" value="0"/>  
      <attribute key="name" value="tjr1fpbl"/>  
      <attribute key="intparts" value="4"/>  
      <attribute key="readonly" value="false"/>  
      <attribute key="editable" value="true"/> 
    </tag>  
    <tag row="2" col="0" rowspan="1" colspan="1" name="NewMultipleHy" label="推荐人2" fieldName=""> 
      <attribute key="isRequired" value="false"/>  
      <attribute key="style" value="width:115px;"/>  
      <attribute key="isDisplayXN" value="true"/>  
      <attribute key="jgckbz" value="jg_ckhy"/>  
      <attribute key="name" value="tjrkhdxdh2"/>  
      <attribute key="multiple" value="false"/>  
      <attribute key="editable" value="true"/> 
    </tag>  
    <tag row="2" col="1" rowspan="1" colspan="1" name="Number" label="分配比例(单位:%)" fieldName="TJR2FPBL"> 
      <attribute key="precision" value="2"/>  
      <attribute key="style" value="width:110px;"/>  
      <attribute key="defVal" value="0"/>  
      <attribute key="name" value="tjr2fpbl"/>  
      <attribute key="intparts" value="4"/>  
      <attribute key="readonly" value="false"/>  
      <attribute key="editable" value="true"/> 
    </tag>  
    <tag row="3" col="0" rowspan="1" colspan="2" name="Textarea" label="备注说明" fieldName="BZSM"> 
      <attribute key="cols" value="30"/>  
      <attribute key="style" value="width:354px;"/>  
      <attribute key="name" value="bzsm"/>  
      <attribute key="styleClass" value="{maxlength:100}"/>  
      <attribute key="readonly" value="false"/>  
      <attribute key="editable" value="true"/>  
      <attribute key="rows" value="4"/> 
    </tag>  
    <tag row="4" col="0" rowspan="1" colspan="1" name="Hidden" label="" fieldName="CZR"> 
      <attribute key="defVal" value="$login_hydh$"/>  
      <attribute key="name" value="czr"/> 
    </tag>  
    <tag row="4" col="1" rowspan="1" colspan="1" name="Hidden" label="" fieldName="TJR2"> 
      <attribute key="name" value="tjr2"/> 
    </tag>  
    <tag row="5" col="0" rowspan="1" colspan="1" name="Hidden" label="" fieldName="CZSJ"> 
      <attribute key="defVal" value="systime"/>  
      <attribute key="name" value="czsj"/> 
    </tag>  
    <tag row="5" col="1" rowspan="1" colspan="1" name="DataInterface" label="null" fieldName=""> 
      <attribute key="dataType" value="select"/>  
      <attribute key="sql" value="select jxdxdh from jxdx_dkzh where zhdh='$zhdh$'"/>  
      <attribute key="name" value="getzh"/> 
    </tag>  
    <tag row="6" col="0" rowspan="1" colspan="1" name="Hidden" label="" fieldName="JXDXDH"> 
      <attribute key="name" value="jxdxdh"/> 
    </tag>  
    <tag row="6" col="1" rowspan="1" colspan="1" name="Hidden" label="" fieldName="TJR1"> 
      <attribute key="name" value="tjr1"/> 
    </tag> 
  </updatePage>  
  <buttons> 
    <button>add</button>  
    <button>edit</button>  
    <button>delete</button>  
    <button>import</button> 
  </buttons>  
  <flow> 
    <insertbefore/>  
    <insertafter/>  
    <deletebefore/>  
    <deleteafter/>  
    <updatebefore/>  
    <updateafter/> 
  </flow>  
  <sqlMap namespace="studio.dktjrgl"> 
    <select id="dn0.dktjrglList" parameterClass="java.util.Map" resultClass="java.util.HashMap" remapResults="true"> 
      <isNotEmpty property="db"><![CDATA[/**!mycat:datanode=$db$**/]]></isNotEmpty> select zh.zhdh,zh.zhhm,sg.tjr1 as tjr1,hy1.hymc as tjr1mc,sg.tjr1fpbl,hy2.hydh as tjr2,hy2.hymc as tjr2mc, sg.tjr2fpbl,sg.bzsm,sg.jxdxdh,hy1.khdxdh as tjrkhdxdh1,hy2.khdxdh as tjrkhdxdh2 from sglr_dktjr sg inner join jxdx_dkzh zh on zh.jxdxdh=sg.jxdxdh inner join khdx_hy hy1 on hy1.hydh=sg.tjr1 left join khdx_hy hy2 on hy2.hydh=sg.tjr2 where 1=1 
      <isNotEmpty property="dkzh">and zh.zhdh like '%$dkzh$%'</isNotEmpty> order by zh.zhdh
    </select>  
    <select id="dn0.dktjrglCount" parameterClass="java.util.Map" resultClass="java.lang.Integer"> 
      <isNotEmpty property="db"><![CDATA[/**!mycat:datanode=$db$**/]]></isNotEmpty> select count(1) from ( select zh.zhdh,zh.zhhm,sg.tjr1 as tjr1,hy1.hymc as tjr1mc,sg.tjr1fpbl,hy2.hydh as tjr2,hy2.hymc as tjr2mc, sg.tjr2fpbl,sg.bzsm,sg.jxdxdh,hy1.khdxdh as tjrkhdxdh1,hy2.khdxdh as tjrkhdxdh2 from sglr_dktjr sg inner join jxdx_dkzh zh on zh.jxdxdh=sg.jxdxdh inner join khdx_hy hy1 on hy1.hydh=sg.tjr1 left join khdx_hy hy2 on hy2.hydh=sg.tjr2 where 1=1 
      <isNotEmpty property="dkzh">and zh.zhdh like '%$dkzh$%'</isNotEmpty> order by zh.zhdh ) t
    </select>  
    <select id="dn0.dktjrgl_select_by_primaryKey" parameterClass="java.util.Map" resultClass="java.util.HashMap" remapResults="true"> 
      <isNotEmpty property="db"><![CDATA[/**!mycat:datanode=$db$**/]]></isNotEmpty> select TJR2FPBL, TJR1FPBL, BZSM, JXDXDH,F_TIMETOCHAR(CZSJ,'yyyy-mm-dd hh24:mi:ss') as CZSJ, CZR, TJR2, TJR1 from SGLR_DKTJR where 1= 1 and JXDXDH = $jxdxdh$
    </select>  
    <select id="dn0.dktjrgl_check_insert" parameterClass="java.util.Map" resultClass="java.util.HashMap"> 
      <isNotEmpty property="db"><![CDATA[/**!mycat:datanode=$db$**/]]></isNotEmpty> select TJR2FPBL, TJR1FPBL, BZSM, JXDXDH,F_TIMETOCHAR(CZSJ,'yyyy-mm-dd hh24:mi:ss') as CZSJ, CZR, TJR2, TJR1 from SGLR_DKTJR where 1= 1 and JXDXDH = $jxdxdh$
    </select>  
    <insert id="dn0.dktjrgl_insert" parameterClass="java.util.Map"> 
      <isNotEmpty property="db"><![CDATA[/**!mycat:datanode=$db$**/]]></isNotEmpty> insert into SGLR_DKTJR( TJR1, TJR2, JXDXDH, TJR2FPBL, CZSJ, CZR, TJR1FPBL, BZSM ) values ( '$tjr1$','$tjr2$',$jxdxdh$,$tjr2fpbl$,f_get_timestamp('$czsj$'),'$czr$',$tjr1fpbl$,'$bzsm$')
    </insert>  
    <update id="dn0.dktjrgl_update" parameterClass="java.util.Map"> 
      <isNotEmpty property="db"><![CDATA[/**!mycat:datanode=$db$**/]]></isNotEmpty> update SGLR_DKTJR set TJR1 = '$tjr1$',TJR2 = '$tjr2$',TJR2FPBL = $tjr2fpbl$,TJR1FPBL = $tjr1fpbl$,BZSM = '$bzsm$' where 1=1 and JXDXDH = $jxdxdh$
    </update>  
    <delete id="dn0.dktjrgl_delete" parameterClass="java.util.Map"> 
      <isNotEmpty property="db"><![CDATA[/**!mycat:datanode=$db$**/]]></isNotEmpty> delete from SGLR_DKTJR where 1=1 and JXDXDH = $jxdxdh$
    </delete>  
    <select id="dn0.dktjrgl_getzh" parameterClass="java.util.Map" resultClass="java.util.HashMap" remapResults="true">/**!mycat:datanode=$db$**/ select jxdxdh from jxdx_dkzh where zhdh='$zhdh$'</select> 
  </sqlMap>  
  <javascript> 
    <import>parent.addTab('dktjrgldr','贷款推荐人管理','/module/parser/import/visitHtml/dktjrgldr');</import>  
    <query>jQuery(document).ready(function () { editpage_height=360; editpage_width=500; }); //自定义验证，在提交时执行。通过返回true，否则返回false function customValidate(){ return true; }</query>  
    <edit>jQuery(document).ready(function () { //这里的js脚本，会在页面加载完成后执行 $('#zhdh').executeOnEvent('blur', 'dktjrgl_getzh', setzh); $('#tjr2fpbl').blur(function(){ var bl2=$('#tjr2fpbl').val(); var yjr2=$('#tjrkhdxdh2').val(); if(yjr2.length==0&amp;&amp;parseFloat(bl2)&gt;0){ custom_alert("请先选择推荐人2！"); } }); if($('#page_operate').val()=='add'){ $("#tjrkhdxdh2").val(""); $("#tjrkhdxdh2_mc").val(""); $("#tjrkhdxdh2_dh").val(""); } if($('#page_operate').val()=='update'){ ; $("#zhdh").attr("disabled","disabled"); } $('#tjrkhdxdh1_mc').parent().css("width","120px"); $('#tjrkhdxdh2_mc').parent().css("width","120px"); // $('#tjr1fpbl').after("&lt;b&gt;&lt;/b&gt;"); //$('#tjr2fpbl').after("&lt;b&gt;&lt;/b&gt;"); }); //自定义验证，在提交时执行。通过返回true，否则返回false function customValidate(){ var bl1=$('#tjr1fpbl').val(); var bl2=$('#tjr2fpbl').val(); var yjr1=$('#tjrkhdxdh1').val(); var yjr2=$('#tjrkhdxdh2').val(); if((parseFloat(bl1)+parseFloat(bl2))&gt;100){ custom_alert("推荐比例之和必须小于或等于100！"); return false; } if(yjr2.length==0&amp;&amp;parseFloat(bl2)&gt;0){ custom_alert("请选择推荐人2！"); $('#tjr2fpbl').val(parseFloat(0)); return false; } if(yjr2.length!=0&amp;&amp;yjr1==yjr2){ custom_alert("推荐人不能同时为一个人！"); return false; } $('#tjr1').val($('#tjrkhdxdh1_dh').val()); if($('#tjrkhdxdh2_dh').val()=='null'){ $('#tjr2').val(""); }else{ $('#tjr2').val($('#tjrkhdxdh2_dh').val()); } return PAS.di.isDone(); } function setzh(obj){ if(obj.status==0){ if(obj.data.length&lt;=0){ $('#zhdh').validationFiled('贷款账号输入错误'); }else{ $('#zhdh').validationPass('dktjrgl_getzh'); $('#jxdxdh').val(obj.data[0].JXDXDH); PAS.di.setDone(obj.sqlid); } } }</edit> 
  </javascript> 
</pageSetting>
