<?xml version="1.0" encoding="UTF-8"?>

<pageSetting id="jgywlmxcx" title="机构业务量明细查询" type="query" version="2.0.0"> 
  <conPart> 
    <tags> 
      <tag row="0" col="0" colspan="1" rowspan="1" name="Date" label="起始日期"> 
        <attribute key="dateFmt" value="yyyyMMdd"/>  
        <attribute key="defValType" value="yc"/>  
        <attribute key="editable" value="true"/>  
        <attribute key="isRequired" value="true"/>  
        <attribute key="name" value="qsrq"/>  
        <attribute key="minDate" value="no"/>  
        <attribute key="readonly" value="false"/> 
      </tag>  
      <tag row="0" col="1" colspan="1" rowspan="1" name="Date" label="结束日期"> 
        <attribute key="dateFmt" value="yyyyMMdd"/>  
        <attribute key="defValType" value="sysDate"/>  
        <attribute key="editable" value="true"/>  
        <attribute key="isRequired" value="true"/>  
        <attribute key="name" value="jsrq"/>  
        <attribute key="minDate" value="no"/>  
        <attribute key="readonly" value="false"/> 
      </tag>  
      <tag row="0" col="2" colspan="1" rowspan="1" name="NewJg" label="机构"> 
        <attribute key="cascadeCheck" value="true"/>  
        <attribute key="editable" value="true"/>  
        <attribute key="ckbz" value="jg"/>  
        <attribute key="isRequired" value="true"/>  
        <attribute key="name" value="jgkhdxdh"/>  
        <attribute key="multiple" value="false"/> 
      </tag>  
      <tag row="0" col="3" colspan="1" rowspan="1" name="Text" label="交易代码"> 
        <attribute key="editable" value="true"/>  
        <attribute key="name" value="jydm"/>  
        <attribute key="readonly" value="false"/> 
      </tag>  
      <tag row="0" col="4" colspan="1" rowspan="1" name="Text" label="交易名称"> 
        <attribute key="editable" value="true"/>  
        <attribute key="name" value="jymc"/>  
        <attribute key="readonly" value="false"/> 
      </tag> 
    </tags> 
  </conPart>  
  <table id="jgywlmxcx_xsjy1jgj" title="新数据源1结果集" page="noCount"> 
    <col id="TJRQ" title="统计日期" align="left" type="string" width="75" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false"/>  
    <col id="JGDH" title="机构代号" align="left" type="string" width="90" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false"/>  
    <col id="JGMC" title="机构名称" align="left" type="string" width="120" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false"/>  
    <col id="JYDM" title="交易代码" align="left" type="string" width="90" frozen="false" format="" exp="true" zsy="true" showDymCol="true" mergeCells="false" footerCells="false"/>  
    <col id="JYMC" title="交易名称" align="left" type="string" width="120" frozen="false" format="" exp="true" zsy="true" showDymCol="true" mergeCells="false" footerCells="false"/>  
    <col id="ZHYWLHJ" title="业务量合计" align="right" type="float" width="120" frozen="false" format="" exp="true" zsy="true" showDymCol="true" mergeCells="false" footerCells="false" xsType="href" onclick="gyywlmx"/>  
    <col id="1370665781144" title="系统业务量" align="left" type="string" width="240" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false"> 
      <col id="XTZQYWL" title="折算前" align="right" type="float" width="120" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false"/>  
      <col id="XTZHYWL" title="折算后" align="right" type="float" width="120" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false"/> 
    </col>  
    <col id="1370665783881" title="手工业务量" align="left" type="string" width="240" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false"> 
      <col id="SGZQYWL" title="折算前" align="right" type="float" width="120" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false"/>  
      <col id="SGZHYWL" title="折算后" align="right" type="float" width="120" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false"/> 
    </col>  
    <col id="1370665784617" title="现金收付量" align="left" type="string" width="240" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false"> 
      <col id="ZQXJSF" title="折算前（万元）" align="right" type="float" width="120" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false"/>  
      <col id="ZHXJSF" title="折算后（笔）" align="right" type="float" width="120" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false"/> 
    </col>  
    <col id="BCYWL" title="补偿业务量" align="right" type="float" width="120" frozen="false" format="" exp="true" zsy="true" showDymCol="true" mergeCells="false" footerCells="false"/>  
    <col id="DQCYXS" title="地区差异系数" align="right" type="string" width="80" frozen="false" format="" exp="true" zsy="true" showDymCol="true" mergeCells="false" footerCells="false"/>  
    <col id="ZSXS" title="折算系数" align="right" type="string" width="80" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false"/>  
    <col id="QSRQ" title="起始日期" align="left" type="hidden" width="75" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false"/>  
    <col id="JSRQ" title="结束日期" align="left" type="hidden" width="75" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false"/>  
    <col id="JGKHDXDH" title="机构考核对象代号" align="left" type="hidden" width="120" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false"/> 
  </table>  
  <sqlMap namespace="studio.jgywlmxcx"> 
    <select id="dn0.jgywlmxcxList" parameterClass="java.util.Map" resultClass="java.util.HashMap" remapResults="true"> 
      <isNotEmpty property="db"><![CDATA[/**!mycat:datanode=$db$**/]]></isNotEmpty> select $qsrq$ qsrq,$jsrq$ jsrq,t.* from ( select f_numtochar(ywl.tjrq) as tjrq,jg.khdxdh jgkhdxdh,jg.jgmc,jg.jgdh,ywl.jydm,jydm.jymc jymc, round(sum(ywl.zhywlhj),2) as zhywlhj, round(sum(ywl.xtzqywl),2) as xtzqywl,round(sum(ywl.xtzhywl),2) as xtzhywl,round(sum(ywl.sgzqywl) ,2) as sgzqywl, round(sum(ywl.sgzhywl),2) as sgzhywl,round((sum(ywl.zqxjsrl)+sum(ywl.zqxjfcl))/10000,2) as zqxjsf, round((sum(ywl.zhxjsrl)+sum(ywl.zhxjfcl)),2) as zhxjsf, f_numtochar(ywl.dqcyxs) as dqcyxs, f_numtochar(ywl.zsxs) as zsxs ,ywl.bcywl from table(FN_GETSJJG_JAVA_QX($sysdate$,$login_khdxdh$,$jgkhdxdh$)) jg inner join nbzz_jgkh_ywl ywl on ywl.khdxdh = jg.khdxdh 
      <isNotEmpty property="qsrq">and ywl.tjrq between $qsrq$ and $jsrq$</isNotEmpty> left join csb_hxjydm jydm on jydm.jydm = ywl.jydm where 1=1 
      <isNotEmpty property="jydm">and ywl.jydm = '$jydm$'</isNotEmpty>  
      <isNotEmpty property="jymc">and jydm.jymc like '%$jymc$%'</isNotEmpty> group by jydm.jymc,ywl.tjrq,jg.khdxdh,jg.jgmc,jg.jgdh,ywl.jydm,ywl.dqcyxs,ywl.zsxs ,ywl.bcywl union all select '合计' as tjrq,0 as jgkhdxdh,' -' jgmc,'-' jgdh,'-' jydm,'-' jymc,sum(ywl.zhywlhj) as zhywlhj, sum(ywl.xtzqywl) as xtzqywl,sum(ywl.xtzhywl) as xtzhywl,sum(ywl.sgzqywl) as sgzqywl,sum(ywl.sgzhywl) as sgzhywl, sum(ywl.zqxjsrl+ywl.zqxjfcl)/10000 as zqxjsf,sum(ywl.zhxjsrl+ywl.zhxjfcl) as zhxjsf, '-' dqcyxs,'-' zsxs,sum(ywl.bcywl) as bcywl from table(FN_GETSJJG_JAVA_QX($sysdate$,$login_khdxdh$,$jgkhdxdh$)) jg inner join nbzz_jgkh_ywl ywl on ywl.khdxdh = jg.khdxdh 
      <isNotEmpty property="qsrq">and ywl.tjrq between $qsrq$ and $jsrq$</isNotEmpty> left join csb_hxjydm jydm on jydm.jydm = ywl.jydm where 1=1 
      <isNotEmpty property="jydm">and ywl.jydm = '$jydm$'</isNotEmpty>  
      <isNotEmpty property="jymc">and jydm.jymc like '%$jymc$%'</isNotEmpty> ) t order by jgmc desc
    </select>  
    <select id="dn0.jgywlmxcxCount" parameterClass="java.util.Map" resultClass="java.lang.Integer"> 
      <isNotEmpty property="db"><![CDATA[/**!mycat:datanode=$db$**/]]></isNotEmpty> select count(1) from ( select $qsrq$ qsrq,$jsrq$ jsrq,t.* from ( select f_numtochar(ywl.tjrq) as tjrq,jg.khdxdh jgkhdxdh,jg.jgmc,jg.jgdh,ywl.jydm,jydm.jymc jymc, round(sum(ywl.zhywlhj),2) as zhywlhj, round(sum(ywl.xtzqywl),2) as xtzqywl,round(sum(ywl.xtzhywl),2) as xtzhywl,round(sum(ywl.sgzqywl) ,2) as sgzqywl, round(sum(ywl.sgzhywl),2) as sgzhywl,round((sum(ywl.zqxjsrl)+sum(ywl.zqxjfcl))/10000,2) as zqxjsf, round((sum(ywl.zhxjsrl)+sum(ywl.zhxjfcl)),2) as zhxjsf, f_numtochar(ywl.dqcyxs) as dqcyxs, f_numtochar(ywl.zsxs) as zsxs ,ywl.bcywl from table(FN_GETSJJG_JAVA_QX($sysdate$,$login_khdxdh$,$jgkhdxdh$)) jg inner join nbzz_jgkh_ywl ywl on ywl.khdxdh = jg.khdxdh 
      <isNotEmpty property="qsrq">and ywl.tjrq between $qsrq$ and $jsrq$</isNotEmpty> left join csb_hxjydm jydm on jydm.jydm = ywl.jydm where 1=1 
      <isNotEmpty property="jydm">and ywl.jydm = '$jydm$'</isNotEmpty>  
      <isNotEmpty property="jymc">and jydm.jymc like '%$jymc$%'</isNotEmpty> group by jydm.jymc,ywl.tjrq,jg.khdxdh,jg.jgmc,jg.jgdh,ywl.jydm,ywl.dqcyxs,ywl.zsxs ,ywl.bcywl union all select '合计' as tjrq,0 as jgkhdxdh,' -' jgmc,'-' jgdh,'-' jydm,'-' jymc,sum(ywl.zhywlhj) as zhywlhj, sum(ywl.xtzqywl) as xtzqywl,sum(ywl.xtzhywl) as xtzhywl,sum(ywl.sgzqywl) as sgzqywl,sum(ywl.sgzhywl) as sgzhywl, sum(ywl.zqxjsrl+ywl.zqxjfcl)/10000 as zqxjsf,sum(ywl.zhxjsrl+ywl.zhxjfcl) as zhxjsf, '-' dqcyxs,'-' zsxs,sum(ywl.bcywl) as bcywl from table(FN_GETSJJG_JAVA_QX($sysdate$,$login_khdxdh$,$jgkhdxdh$)) jg inner join nbzz_jgkh_ywl ywl on ywl.khdxdh = jg.khdxdh 
      <isNotEmpty property="qsrq">and ywl.tjrq between $qsrq$ and $jsrq$</isNotEmpty> left join csb_hxjydm jydm on jydm.jydm = ywl.jydm where 1=1 
      <isNotEmpty property="jydm">and ywl.jydm = '$jydm$'</isNotEmpty>  
      <isNotEmpty property="jymc">and jydm.jymc like '%$jymc$%'</isNotEmpty> ) t order by jgmc desc ) t
    </select> 
  </sqlMap>  
  <rels> 
    <items id="jgywlmxcx_xsjy1jgj"/> 
  </rels>  
  <javascript><![CDATA[jQuery(document).ready(function () {

});


//自定义验证，在提交时执行。通过返回true，否则返回false
function customValidate(){
 return true;
}

function gyywlmx(obj){
var params="{qsrq:'"+obj['QSRQ']+"',jsrq:'"+obj['JSRQ']+"'"
             +",jydm:'"+obj['JYDM']+"'"
             +", jgkhdxdh:'"+obj['JGKHDXDH']+"'}";
          
  querySubQuery(params,'gyywlmxcx','45','30','tag');

}

//去除合计行链接样式
function customOnLoadSuccess(data){
   $(".datagrid-body tr").each(function(){
     var tr = $(this);
     var tdTjrq = tr.find("td[field='TJRQ']").find('div:eq(0)');
     var tdHj = tr.find("td[field='ZHYWLHJ']").find('a:eq(0)');
     if(tdTjrq.text() == '合计'){
       tdHj.parent().html(tdHj.text());
     }
  });
}]]></javascript> 
</pageSetting>
