<?xml version="1.0" encoding="UTF-8"?>

<pageSetting id="hyyjbb" title="行员业绩报表" type="query" version="2.0.0"> 
  <conPart> 
    <tags> 
      <tag row="0" col="0" colspan="1" rowspan="1" name="Date" label="统计日期"> 
        <attribute key="dateFmt" value="yyyyMMdd"/>  
        <attribute key="defValType" value="sysDate"/>  
        <attribute key="editable" value="true"/>  
        <attribute key="isRequired" value="true"/>  
        <attribute key="name" value="tjrq"/>  
        <attribute key="minDate" value="no"/> 
      </tag>  
      <tag row="0" col="1" colspan="1" rowspan="1" name="NewMultipleHy" label="行员"> 
        <attribute key="isDisplayXN" value="true"/>  
        <attribute key="editable" value="true"/>  
        <attribute key="isRequired" value="true"/>  
        <attribute key="jgckbz" value="jg_ckhy"/>  
        <attribute key="name" value="hykhdxdh"/>  
        <attribute key="multiple" value="true"/> 
      </tag>  
      <tag row="0" col="2" colspan="1" rowspan="1" name="Dmms" label="业绩类型"> 
        <attribute key="width" value="120px;"/>  
        <attribute key="dmmc" value="yjlx"/>  
        <attribute key="editable" value="true"/>  
        <attribute key="name" value="yjlx"/>  
        <attribute key="isAll" value="false"/>  
        <attribute key="multiple" value="false"/> 
      </tag>  
      <tag row="0" col="2" colspan="1" rowspan="1" name="Hidden" label=""> 
        <attribute key="name" value="tjrq_sntq1"/> 
      </tag>  
      <tag row="1" col="0" colspan="2" rowspan="1" name="MSQL4Select" label="指标"> 
        <attribute key="isMultiple" value="false"/>  
        <attribute key="width" value="240px;"/>  
        <attribute key="isSearch" value="true"/>  
        <attribute key="sql" value="select khzbdh as KEY,khzbmc as VALUE from khfa_khzb_hy order by zbpx,zbdh"/>  
        <attribute key="isRequired" value="false"/>  
        <attribute key="name" value="khzb"/>  
        <attribute key="isAll" value="false"/>  
        <attribute key="isEditable" value="true"/> 
      </tag>  
      <tag row="2" col="0" colspan="1" rowspan="1" name="Qxyw" label="业务类别"> 
        <attribute key="width" value="120px;"/>  
        <attribute key="editable" value="true"/>  
        <attribute key="name" value="ywlb"/>  
        <attribute key="isAll" value="false"/>  
        <attribute key="multiple" value="false"/> 
      </tag>  
      <tag row="2" col="1" colspan="1" rowspan="1" name="Zb" label="指标"> 
        <attribute key="parents" value="ywlb"/>  
        <attribute key="isMultiple" value="false"/>  
        <attribute key="width" value="120px;"/>  
        <attribute key="isSearch" value="true"/>  
        <attribute key="isRequired" value="false"/>  
        <attribute key="name" value="zbdh"/>  
        <attribute key="isAll" value="false"/>  
        <attribute key="isEditable" value="true"/> 
      </tag>  
      <tag row="2" col="2" colspan="1" rowspan="1" name="ZbParam" label="币种"> 
        <attribute key="parents" value="zbdh"/>  
        <attribute key="isMultiple" value="false"/>  
        <attribute key="width" value="120px;"/>  
        <attribute key="isRequired" value="false"/>  
        <attribute key="name" value="bz"/>  
        <attribute key="isAll" value="false"/>  
        <attribute key="isEditable" value="true"/>  
        <attribute key="paramType" value="bz"/> 
      </tag>  
      <tag row="2" col="3" colspan="1" rowspan="1" name="ZbParam" label="时段标识"> 
        <attribute key="parents" value="zbdh"/>  
        <attribute key="isMultiple" value="false"/>  
        <attribute key="width" value="120px;"/>  
        <attribute key="isRequired" value="false"/>  
        <attribute key="name" value="sdbs"/>  
        <attribute key="isAll" value="false"/>  
        <attribute key="isEditable" value="true"/>  
        <attribute key="paramType" value="sdbs"/> 
      </tag>  
      <tag row="2" col="3" colspan="1" rowspan="1" name="Hidden" label=""> 
        <attribute key="name" value="jzsjy"/> 
      </tag>  
      <tag row="2" col="3" colspan="1" rowspan="1" name="Hidden" label=""> 
        <attribute key="defVal" value="$sysDate$"/>  
        <attribute key="name" value="sysDate"/> 
      </tag> 
    </tags> 
  </conPart>  
  <table id="hyyjbb_xsjy1jgj" title="新数据源1结果集" page="noCount"> 
    <col id="TJRQ" title="统计日期" align="left" type="string" width="75" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false"/>  
    <col id="HYDH" title="行员代号" align="left" type="string" width="120" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false"/>  
    <col id="HYMC" title="行员名称" align="left" type="string" width="120" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false"/>  
    <col id="ZBMC" title="指标名称" align="left" type="string" width="200" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false"/>  
    <col id="1383273906770" title="比较项" align="left" type="string" width="600" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false"> 
      <col id="ZBSJ" title="指标实绩" align="right" type="float" width="120" frozen="false" format="###,##0.00" exp="true" zsy="true" showDymCol="true" mergeCells="false" footerCells="false"/>  
      <col id="BQNTQ" title="比去年同期" align="right" type="float" width="120" frozen="false" format="###,##0.00" exp="true" zsy="true" showDymCol="true" mergeCells="false" footerCells="false"/>  
      <col id="BNC" title="比年初" align="right" type="float" width="120" frozen="false" format="###,##0.00" exp="true" zsy="true" showDymCol="true" mergeCells="false" footerCells="false"/>  
      <col id="BJC" title="比季初" align="right" type="float" width="120" frozen="false" format="###,##0.00" exp="true" zsy="true" showDymCol="true" mergeCells="false" footerCells="false"/>  
      <col id="BYC" title="比月初" align="right" type="float" width="120" frozen="false" format="###,##0.00" exp="true" zsy="true" showDymCol="true" mergeCells="false" footerCells="false"/> 
    </col> 
  </table>  
  <table id="hyyjbb_xsjy2jgj" title="新数据源2结果集" page="noCount"> 
    <col id="TJRQ" title="统计日期" align="left" type="string" width="75" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false"/>  
    <col id="HYDH" title="行员代号" align="left" type="string" width="120" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false"/>  
    <col id="HYMC" title="行员名称" align="left" type="string" width="120" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false"/>  
    <col id="ZBMC" title="指标名称" align="left" type="string" width="200" frozen="false" format="" exp="true" zsy="true" showDymCol="true" mergeCells="false" footerCells="false"/>  
    <col id="BZ" title="币种" align="left" type="string" width="75" frozen="false" format="" exp="true" zsy="true" showDymCol="true" mergeCells="false" footerCells="false"/>  
    <col id="SDBS" title="时段标识" align="left" type="string" width="75" frozen="false" format="" exp="true" zsy="true" showDymCol="true" mergeCells="false" footerCells="false"/>  
    <col id="1383722827354" title="比较项" align="left" type="float" width="600" frozen="false" format="###,###.00" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false"> 
      <col id="ZBSJ" title="指标实绩" align="right" type="float" width="120" frozen="false" format="###,##0.00" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false"/>  
      <col id="BQNTQ" title="比去年同期" align="right" type="float" width="120" frozen="false" format="###,##0.00" exp="true" zsy="true" showDymCol="true" mergeCells="false" footerCells="false"/>  
      <col id="BNC" title="比年初" align="right" type="float" width="120" frozen="false" format="###,##0.00" exp="true" zsy="true" showDymCol="true" mergeCells="false" footerCells="false"/>  
      <col id="BJC" title="比季初" align="right" type="float" width="120" frozen="false" format="###,##0.00" exp="true" zsy="true" showDymCol="true" mergeCells="false" footerCells="false"/>  
      <col id="BYC" title="比月初" align="right" type="float" width="120" frozen="false" format="###,##0.00" exp="true" zsy="true" showDymCol="true" mergeCells="false" footerCells="false"/> 
    </col> 
  </table>  
  <table id="hyyjbb_khzb_tdrjjgj" title="考核指标_特定日期结果集" page="noCount"> 
    <col id="TJRQ" title="统计日期" align="left" type="string" width="75" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false"/>  
    <col id="HYDH" title="行员代号" align="left" type="string" width="75" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false"/>  
    <col id="HYMC" title="行员名称" align="left" type="string" width="90" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false"/>  
    <col id="ZBMC" title="指标名称" align="left" type="string" width="200" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false"/>  
    <col id="1459244315225" title="比较项" align="left" type="string" width="600" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false"> 
      <col id="ZBSJ" title="指标实绩" align="right" type="float" width="120" frozen="false" format="###,##0.00" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false"/>  
      <col id="BQNTQ" title="比去年同期" align="right" type="float" width="120" frozen="false" format="###,##0.00" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false"/>  
      <col id="BNC" title="比年初" align="right" type="float" width="120" frozen="false" format="###,##0.00" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false"/>  
      <col id="BJC" title="比季初" align="right" type="float" width="120" frozen="false" format="###,##0.00" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false"/>  
      <col id="BYC" title="比月初" align="right" type="float" width="120" frozen="false" format="###,##0.00" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false"/> 
    </col> 
  </table>  
  <table id="hyyjbb_fxzb_tdrjjgj" title="分析指标_特定日期结果集" page="noCount"> 
    <col id="TJRQ" title="统计日期" align="left" type="string" width="75" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false"/>  
    <col id="HYDH" title="行员代号" align="left" type="string" width="75" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false"/>  
    <col id="HYMC" title="行员名称" align="left" type="string" width="90" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false"/>  
    <col id="ZBMC" title="指标名称" align="left" type="string" width="200" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false"/>  
    <col id="BZ" title="币种" align="left" type="string" width="75" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false"/>  
    <col id="SDBS" title="时段标识" align="left" type="string" width="75" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false"/>  
    <col id="1459244351649" title="比较项" align="left" type="string" width="600" frozen="false" format="" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false"> 
      <col id="ZBSJ" title="指标实绩" align="right" type="float" width="120" frozen="false" format="###,##0.00" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false"/>  
      <col id="BQNTQ" title="比去年同期" align="right" type="float" width="120" frozen="false" format="###,##0.00" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false"/>  
      <col id="BNC" title="比年初" align="right" type="float" width="120" frozen="false" format="###,##0.00" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false"/>  
      <col id="BJC" title="比季初" align="right" type="float" width="120" frozen="false" format="###,##0.00" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false"/>  
      <col id="BYC" title="比月初" align="right" type="float" width="120" frozen="false" format="###,##0.00" exp="true" zsy="true" showDymCol="false" mergeCells="false" footerCells="false"/> 
    </col> 
  </table>  
  <sqlMap namespace="studio.hyyjbb"> 
    <select id="dn1.hyyjbbList" parameterClass="java.util.Map" resultClass="java.util.HashMap" remapResults="true"> 
      <isNotEmpty property="db"><![CDATA[/**!mycat:datanode=$db$**/]]></isNotEmpty>  
      <isEqual property="jzsjy" compareValue="hykhzb">select a.tjrq, a.hydh, a.hymc, a.zbmc, a.zbsj, (a.zbsj-a.qnye) bqntq, (a.zbsj-a.ncye) bnc, (a.zbsj-a.jcye) bjc, (a.zbsj-a.ycye) byc from( select t2.khdxdh,t2.hydh,t2.hymc,t2.zbdh,t2.khzbmc zbmc,$tjrq$ tjrq, sum(t2.zbsj) zbsj ,sum(t2.ncye) ncye,sum(t2.jcye) jcye,sum(t2.ycye) ycye,sum(t2.qnye) qnye from ( select yj.khdxdh,hy.hydh,hy.hymc,yj.zbdh,yj.khzbmc, case when $tjrq$ = yj.tjrq then zbz else 0 end zbsj, case when $tjrq_nc$ = yj.tjrq then zbz else 0 end ncye, case when $tjrq_jc$ = yj.tjrq then zbz else 0 end jcye, case when $tjrq_yc$ = yj.tjrq then zbz else 0 end ycye, case when $tjrq_sntq$ = yj.tjrq then zbz else 0 end qnye from ( select d.khdxdh,d.tjrq,d.zbdh,zbz,khzb.khzbmc from yjzb_hy_$tjrq_yyyy$ d inner join khfa_khzb_hy khzb on d.zbdh = khzb.zbdh and d.sdbs=khzb.sdbs and d.bz = khzb.bz 
        <isNotEmpty property="khzb">and khzb.khzbdh = $khzb$</isNotEmpty>  
        <isNotEmpty property="hykhdxdh">where d.khdxdh in ($hykhdxdh$)</isNotEmpty>  
        <isNotEmpty property="tjrq">and d.tjrq=$tjrq$</isNotEmpty> union all select b.khdxdh,b.tjrq,b.zbdh,zbz,khzb.khzbmc from yjzb_hy_$tjrq_sntq1$ b inner join khfa_khzb_hy khzb on b.zbdh = khzb.zbdh and b.sdbs=khzb.sdbs and b.bz = khzb.bz 
        <isNotEmpty property="khzb">and khzb.khzbdh = $khzb$</isNotEmpty>  
        <isNotEmpty property="hykhdxdh">where b.khdxdh in ($hykhdxdh$)</isNotEmpty>  
        <isNotEmpty property="tjrq_sntq">and b.tjrq=$tjrq_sntq$</isNotEmpty> union all select c.khdxdh,c.tjrq,c.zbdh,zbz,khzb.khzbmc from yjzb_gjyj_hy c inner join khfa_khzb_hy khzb on c.zbdh = khzb.zbdh and c.sdbs=khzb.sdbs and c.bz = khzb.bz 
        <isNotEmpty property="khzb">and khzb.khzbdh = $khzb$</isNotEmpty> where c.sjwd='3' 
        <isNotEmpty property="tjrq_nc">and (c.tjrq = $tjrq_nc$</isNotEmpty> or c.tjrq = $tjrq_jc$ or c.tjrq = $tjrq_yc$) 
        <isNotEmpty property="hykhdxdh">and c.khdxdh in ($hykhdxdh$)</isNotEmpty> ) yj inner join khdx_hy hy on hy.khdxdh = yj.khdxdh inner join table(fn_getsjjg_java_qxhy($tjrq$,$login_khdxdh$,0)) qx on qx.khdxdh=yj.KHDXDH ) t2 group by t2.khdxdh,t2.hydh,t2.hymc,t2.zbdh,t2.khzbmc )a order by a.tjrq asc,a.hydh asc
      </isEqual>  
      <isEqual property="jzsjy" compareValue="hyfxzb">select a.tjrq,a.hydh,a.hymc,a.zbmc,a.bzzwmc as bz, a.dmms as sdbs,a.zbsj,(a.zbsj-a.qnye) bqntq,(a.zbsj-a.ncye) bnc,(a.zbsj-a.jcye) bjc,(a.zbsj-a.ycye) byc from( select yjzb.khdxdh khdxdh,$tjrq$ tjrq,hy.hydh hydh,hy.hymc hymc,khzb.zbmc zbmc,bz.bzzwmc,dmms.dmms, coalesce(max(case when yjzb.tjrq = $tjrq$ then yjzb.zbz end),0) zbsj, coalesce(max(case when yjzb.tjrq = $tjrq_nc$ then yjzb.zbz end),0) ncye, coalesce(max(case when yjzb.tjrq = $tjrq_jc$ then yjzb.zbz end),0) jcye, coalesce(max(case when yjzb.tjrq = $tjrq_yc$ then yjzb.zbz end),0) ycye, coalesce(max(case when yjzb.tjrq = $tjrq_sntq$ then yjzb.zbz end),0) qnye from ( select khdxdh,tjrq,zbdh,bz,sdbs,zbz from yjzb_hy_$tjrq_yyyy$ d
        <isNotEmpty property="hykhdxdh">where d.khdxdh in ($hykhdxdh$)</isNotEmpty>  
        <isNotEmpty property="zbdh">and d.zbdh=$zbdh$</isNotEmpty>  
        <isNotEmpty property="bz">and d.bz='$bz$'</isNotEmpty>  
        <isNotEmpty property="sdbs">and d.sdbs='$sdbs$'</isNotEmpty>  
        <isNotEmpty property="tjrq">and d.tjrq=$tjrq$</isNotEmpty> union all select khdxdh,tjrq,zbdh,bz,sdbs,zbz from yjzb_hy_$tjrq_sntq1$ b 
        <isNotEmpty property="hykhdxdh">where b.khdxdh in ($hykhdxdh$)</isNotEmpty>  
        <isNotEmpty property="zbdh">and b.zbdh=$zbdh$</isNotEmpty>  
        <isNotEmpty property="bz">and b.bz='$bz$'</isNotEmpty>  
        <isNotEmpty property="sdbs">and b.sdbs='$sdbs$'</isNotEmpty>  
        <isNotEmpty property="tjrq_sntq">and b.tjrq=$tjrq_sntq$</isNotEmpty> union all select khdxdh,tjrq,zbdh,bz,sdbs,zbz from yjzb_gjyj_hy c where c.sjwd='3' 
        <isNotEmpty property="tjrq_nc">and (c.tjrq = $tjrq_nc$</isNotEmpty> or c.tjrq = $tjrq_jc$ or c.tjrq = $tjrq_yc$) 
        <isNotEmpty property="hykhdxdh">and c.khdxdh in ($hykhdxdh$)</isNotEmpty>  
        <isNotEmpty property="zbdh">and c.zbdh=$zbdh$</isNotEmpty>  
        <isNotEmpty property="bz">and c.bz='$bz$'</isNotEmpty>  
        <isNotEmpty property="sdbs">and c.sdbs='$sdbs$'</isNotEmpty> ) yjzb inner join khdx_zb khzb on yjzb.zbdh = khzb.zbdh inner join CSB_DMMS dmms on dmms.dmmc = 'ZBSDBS' and dmms.dmz = yjzb.sdbs inner join csb_bz bz on bz.bz = yjzb.bz inner join table(fn_getsjjg_java_qxhy($tjrq$,$login_khdxdh$,0)) qx on qx.khdxdh=yjzb.KHDXDH inner join khdx_hy hy on yjzb.khdxdh = hy.khdxdh group by yjzb.khdxdh,hy.hydh,hy.hymc,khzb.zbmc,bz.bzzwmc,dmms.dmms ) a order by a.tjrq asc,a.hydh asc
      </isEqual>  
      <isEqual property="jzsjy" compareValue="gjyjkhzb">select a.tjrq, a.hydh, a.hymc, a.zbmc, a.zbsj, (a.zbsj-a.qnye) bqntq, (a.zbsj-a.ncye) bnc, (a.zbsj-a.jcye) bjc, (a.zbsj-a.ycye) byc from( select t2.khdxdh,t2.hydh,t2.hymc,t2.zbdh,t2.khzbmc zbmc,$tjrq$ tjrq, sum(t2.zbsj) zbsj ,sum(t2.ncye) ncye,sum(t2.jcye) jcye,sum(t2.ycye) ycye,sum(t2.qnye) qnye from ( select yj.khdxdh,hy.hydh,hy.hymc,khzb.zbdh,khzb.khzbmc, case when $tjrq$ = yj.tjrq then zbz else 0 end zbsj, case when $tjrq_nc$ = yj.tjrq then zbz else 0 end ncye, case when $tjrq_jc$ = yj.tjrq then zbz else 0 end jcye, case when $tjrq_yc$ = yj.tjrq then zbz else 0 end ycye, case when $tjrq_sntq$ = yj.tjrq then zbz else 0 end qnye from yjzb_gjyj_hy yj inner join khdx_hy hy on hy.khdxdh = yj.khdxdh inner join table(fn_getsjjg_java_qxhy($tjrq$,$login_khdxdh$,0)) qx on qx.khdxdh=yj.KHDXDH inner join khfa_khzb_hy khzb on yj.zbdh = khzb.zbdh and yj.sdbs=khzb.sdbs and yj.bz = khzb.bz 
        <isNotEmpty property="khzb">and khzb.khzbdh = $khzb$</isNotEmpty> where yj.tjrq in($tjrq$,$tjrq_nc$,$tjrq_jc$,$tjrq_yc$,$tjrq_sntq$) 
        <isNotEmpty property="hykhdxdh">and yj.khdxdh in ($hykhdxdh$)</isNotEmpty> and yj.sjwd in('2','3') ) t2 group by t2.khdxdh,t2.hydh,t2.hymc,t2.zbdh,t2.khzbmc )a order by a.tjrq asc,a.hydh asc
      </isEqual>  
      <isEqual property="jzsjy" compareValue="gjyjfxzb">select a.tjrq,a.hydh,a.hymc,a.zbmc,a.bzzwmc as bz, a.dmms as sdbs,a.zbsj,(a.zbsj-a.qnye) bqntq,(a.zbsj-a.ncye) bnc,(a.zbsj-a.jcye) bjc,(a.zbsj-a.ycye) byc from( select yjzb.khdxdh khdxdh,$tjrq$ tjrq,hy.hydh hydh,hy.hymc hymc,khzb.zbmc zbmc,bz.bzzwmc,dmms.dmms, coalesce(max(case when yjzb.tjrq = $tjrq$ then yjzb.zbz end),0) zbsj, coalesce(max(case when yjzb.tjrq = $tjrq_nc$ then yjzb.zbz end),0) ncye, coalesce(max(case when yjzb.tjrq = $tjrq_jc$ then yjzb.zbz end),0) jcye, coalesce(max(case when yjzb.tjrq = $tjrq_yc$ then yjzb.zbz end),0) ycye, coalesce(max(case when yjzb.tjrq = $tjrq_sntq$ then yjzb.zbz end),0) qnye from yjzb_gjyj_hy yjzb inner join khdx_zb khzb on yjzb.zbdh = khzb.zbdh inner join CSB_DMMS dmms on dmms.dmmc = 'ZBSDBS' and dmms.dmz = yjzb.sdbs inner join csb_bz bz on bz.bz = yjzb.bz inner join table(fn_getsjjg_java_qxhy($tjrq$,$login_khdxdh$,0)) qx on qx.khdxdh=yjzb.KHDXDH inner join khdx_hy hy on yjzb.khdxdh = hy.khdxdh where 1=1 
        <isNotEmpty property="hykhdxdh">and hy.khdxdh in ($hykhdxdh$)</isNotEmpty>  
        <isNotEmpty property="zbdh">and khzb.zbdh=$zbdh$</isNotEmpty>  
        <isNotEmpty property="bz">and yjzb.bz='$bz$'</isNotEmpty>  
        <isNotEmpty property="sdbs">and yjzb.sdbs='$sdbs$'</isNotEmpty> and yjzb.tjrq in($tjrq$,$tjrq_nc$,$tjrq_jc$,$tjrq_yc$,$tjrq_sntq$) and yjzb.sjwd in('2','3') group by yjzb.khdxdh,hy.hydh,hy.hymc,khzb.zbmc,bz.bzzwmc,dmms.dmms ) a order by a.tjrq asc,a.hydh asc
      </isEqual> 
    </select>  
    <select id="dn1.hyyjbbCount" parameterClass="java.util.Map" resultClass="java.lang.Integer"> 
      <isNotEmpty property="db"><![CDATA[/**!mycat:datanode=$db$**/]]></isNotEmpty> select count(1) from ( 
      <isEqual property="jzsjy" compareValue="hykhzb">select a.tjrq, a.hydh, a.hymc, a.zbmc, a.zbsj, (a.zbsj-a.qnye) bqntq, (a.zbsj-a.ncye) bnc, (a.zbsj-a.jcye) bjc, (a.zbsj-a.ycye) byc from( select t2.khdxdh,t2.hydh,t2.hymc,t2.zbdh,t2.khzbmc zbmc,$tjrq$ tjrq, sum(t2.zbsj) zbsj ,sum(t2.ncye) ncye,sum(t2.jcye) jcye,sum(t2.ycye) ycye,sum(t2.qnye) qnye from ( select yj.khdxdh,hy.hydh,hy.hymc,yj.zbdh,yj.khzbmc, case when $tjrq$ = yj.tjrq then zbz else 0 end zbsj, case when $tjrq_nc$ = yj.tjrq then zbz else 0 end ncye, case when $tjrq_jc$ = yj.tjrq then zbz else 0 end jcye, case when $tjrq_yc$ = yj.tjrq then zbz else 0 end ycye, case when $tjrq_sntq$ = yj.tjrq then zbz else 0 end qnye from ( select d.khdxdh,d.tjrq,d.zbdh,zbz,khzb.khzbmc from yjzb_hy_$tjrq_yyyy$ d inner join khfa_khzb_hy khzb on d.zbdh = khzb.zbdh and d.sdbs=khzb.sdbs and d.bz = khzb.bz 
        <isNotEmpty property="khzb">and khzb.khzbdh = $khzb$</isNotEmpty>  
        <isNotEmpty property="hykhdxdh">where d.khdxdh in ($hykhdxdh$)</isNotEmpty>  
        <isNotEmpty property="tjrq">and d.tjrq=$tjrq$</isNotEmpty> union all select b.khdxdh,b.tjrq,b.zbdh,zbz,khzb.khzbmc from yjzb_hy_$tjrq_sntq1$ b inner join khfa_khzb_hy khzb on b.zbdh = khzb.zbdh and b.sdbs=khzb.sdbs and b.bz = khzb.bz 
        <isNotEmpty property="khzb">and khzb.khzbdh = $khzb$</isNotEmpty>  
        <isNotEmpty property="hykhdxdh">where b.khdxdh in ($hykhdxdh$)</isNotEmpty>  
        <isNotEmpty property="tjrq_sntq">and b.tjrq=$tjrq_sntq$</isNotEmpty> union all select c.khdxdh,c.tjrq,c.zbdh,zbz,khzb.khzbmc from yjzb_gjyj_hy c inner join khfa_khzb_hy khzb on c.zbdh = khzb.zbdh and c.sdbs=khzb.sdbs and c.bz = khzb.bz 
        <isNotEmpty property="khzb">and khzb.khzbdh = $khzb$</isNotEmpty> where c.sjwd='3' 
        <isNotEmpty property="tjrq_nc">and (c.tjrq = $tjrq_nc$</isNotEmpty> or c.tjrq = $tjrq_jc$ or c.tjrq = $tjrq_yc$) 
        <isNotEmpty property="hykhdxdh">and c.khdxdh in ($hykhdxdh$)</isNotEmpty> ) yj inner join khdx_hy hy on hy.khdxdh = yj.khdxdh inner join table(fn_getsjjg_java_qxhy($tjrq$,$login_khdxdh$,0)) qx on qx.khdxdh=yj.KHDXDH ) t2 group by t2.khdxdh,t2.hydh,t2.hymc,t2.zbdh,t2.khzbmc )a order by a.tjrq asc,a.hydh asc
      </isEqual>  
      <isEqual property="jzsjy" compareValue="hyfxzb">select a.tjrq,a.hydh,a.hymc,a.zbmc,a.bzzwmc as bz, a.dmms as sdbs,a.zbsj,(a.zbsj-a.qnye) bqntq,(a.zbsj-a.ncye) bnc,(a.zbsj-a.jcye) bjc,(a.zbsj-a.ycye) byc from( select yjzb.khdxdh khdxdh,$tjrq$ tjrq,hy.hydh hydh,hy.hymc hymc,khzb.zbmc zbmc,bz.bzzwmc,dmms.dmms, coalesce(max(case when yjzb.tjrq = $tjrq$ then yjzb.zbz end),0) zbsj, coalesce(max(case when yjzb.tjrq = $tjrq_nc$ then yjzb.zbz end),0) ncye, coalesce(max(case when yjzb.tjrq = $tjrq_jc$ then yjzb.zbz end),0) jcye, coalesce(max(case when yjzb.tjrq = $tjrq_yc$ then yjzb.zbz end),0) ycye, coalesce(max(case when yjzb.tjrq = $tjrq_sntq$ then yjzb.zbz end),0) qnye from ( select khdxdh,tjrq,zbdh,bz,sdbs,zbz from yjzb_hy_$tjrq_yyyy$ d 
        <isNotEmpty property="hykhdxdh">where d.khdxdh in ($hykhdxdh$)</isNotEmpty>  
        <isNotEmpty property="zbdh">and d.zbdh=$zbdh$</isNotEmpty>  
        <isNotEmpty property="bz">and d.bz='$bz$'</isNotEmpty>  
        <isNotEmpty property="sdbs">and d.sdbs='$sdbs$'</isNotEmpty>  
        <isNotEmpty property="tjrq">and d.tjrq=$tjrq$</isNotEmpty> union all select khdxdh,tjrq,zbdh,bz,sdbs,zbz from yjzb_hy_$tjrq_sntq1$ b 
        <isNotEmpty property="hykhdxdh">where b.khdxdh in ($hykhdxdh$)</isNotEmpty>  
        <isNotEmpty property="zbdh">and b.zbdh=$zbdh$</isNotEmpty>  
        <isNotEmpty property="bz">and b.bz='$bz$'</isNotEmpty>  
        <isNotEmpty property="sdbs">and b.sdbs='$sdbs$'</isNotEmpty>  
        <isNotEmpty property="tjrq_sntq">and b.tjrq=$tjrq_sntq$</isNotEmpty> union all select khdxdh,tjrq,zbdh,bz,sdbs,zbz from yjzb_gjyj_hy c where c.sjwd='3' 
        <isNotEmpty property="tjrq_nc">and (c.tjrq = $tjrq_nc$</isNotEmpty> or c.tjrq = $tjrq_jc$ or c.tjrq = $tjrq_yc$) 
        <isNotEmpty property="hykhdxdh">and c.khdxdh in ($hykhdxdh$)</isNotEmpty>  
        <isNotEmpty property="zbdh">and c.zbdh=$zbdh$</isNotEmpty>  
        <isNotEmpty property="bz">and c.bz='$bz$'</isNotEmpty>  
        <isNotEmpty property="sdbs">and c.sdbs='$sdbs$'</isNotEmpty> ) yjzb inner join khdx_zb khzb on yjzb.zbdh = khzb.zbdh inner join CSB_DMMS dmms on dmms.dmmc = 'ZBSDBS' and dmms.dmz = yjzb.sdbs inner join csb_bz bz on bz.bz = yjzb.bz inner join table(fn_getsjjg_java_qxhy($tjrq$,$login_khdxdh$,0)) qx on qx.khdxdh=yjzb.KHDXDH inner join khdx_hy hy on yjzb.khdxdh = hy.khdxdh group by yjzb.khdxdh,hy.hydh,hy.hymc,khzb.zbmc,bz.bzzwmc,dmms.dmms ) a order by a.tjrq asc,a.hydh asc
      </isEqual>  
      <isEqual property="jzsjy" compareValue="gjyjkhzb">select a.tjrq, a.hydh, a.hymc, a.zbmc, a.zbsj, (a.zbsj-a.qnye) bqntq, (a.zbsj-a.ncye) bnc, (a.zbsj-a.jcye) bjc, (a.zbsj-a.ycye) byc from( select t2.khdxdh,t2.hydh,t2.hymc,t2.zbdh,t2.khzbmc zbmc,$tjrq$ tjrq, sum(t2.zbsj) zbsj ,sum(t2.ncye) ncye,sum(t2.jcye) jcye,sum(t2.ycye) ycye,sum(t2.qnye) qnye from ( select yj.khdxdh,hy.hydh,hy.hymc,khzb.zbdh,khzb.khzbmc, case when $tjrq$ = yj.tjrq then zbz else 0 end zbsj, case when $tjrq_nc$ = yj.tjrq then zbz else 0 end ncye, case when $tjrq_jc$ = yj.tjrq then zbz else 0 end jcye, case when $tjrq_yc$ = yj.tjrq then zbz else 0 end ycye, case when $tjrq_sntq$ = yj.tjrq then zbz else 0 end qnye from yjzb_gjyj_hy yj inner join khdx_hy hy on hy.khdxdh = yj.khdxdh inner join table(fn_getsjjg_java_qxhy($tjrq$,$login_khdxdh$,0)) qx on qx.khdxdh=yj.KHDXDH inner join khfa_khzb_hy khzb on yj.zbdh = khzb.zbdh and yj.sdbs=khzb.sdbs and yj.bz = khzb.bz 
        <isNotEmpty property="khzb">and khzb.khzbdh = $khzb$</isNotEmpty> where yj.tjrq in($tjrq$,$tjrq_nc$,$tjrq_jc$,$tjrq_yc$,$tjrq_sntq$) 
        <isNotEmpty property="hykhdxdh">and yj.khdxdh in ($hykhdxdh$)</isNotEmpty> and yj.sjwd in('2','3') ) t2 group by t2.khdxdh,t2.hydh,t2.hymc,t2.zbdh,t2.khzbmc )a order by a.tjrq asc,a.hydh asc
      </isEqual>  
      <isEqual property="jzsjy" compareValue="gjyjfxzb">select a.tjrq,a.hydh,a.hymc,a.zbmc,a.bzzwmc as bz, a.dmms as sdbs,a.zbsj,(a.zbsj-a.qnye) bqntq,(a.zbsj-a.ncye) bnc,(a.zbsj-a.jcye) bjc,(a.zbsj-a.ycye) byc from( select yjzb.khdxdh khdxdh,$tjrq$ tjrq,hy.hydh hydh,hy.hymc hymc,khzb.zbmc zbmc,bz.bzzwmc,dmms.dmms, coalesce(max(case when yjzb.tjrq = $tjrq$ then yjzb.zbz end),0) zbsj, coalesce(max(case when yjzb.tjrq = $tjrq_nc$ then yjzb.zbz end),0) ncye, coalesce(max(case when yjzb.tjrq = $tjrq_jc$ then yjzb.zbz end),0) jcye, coalesce(max(case when yjzb.tjrq = $tjrq_yc$ then yjzb.zbz end),0) ycye, coalesce(max(case when yjzb.tjrq = $tjrq_sntq$ then yjzb.zbz end),0) qnye from yjzb_gjyj_hy yjzb inner join khdx_zb khzb on yjzb.zbdh = khzb.zbdh inner join CSB_DMMS dmms on dmms.dmmc = 'ZBSDBS' and dmms.dmz = yjzb.sdbs inner join csb_bz bz on bz.bz = yjzb.bz inner join table(fn_getsjjg_java_qxhy($tjrq$,$login_khdxdh$,0)) qx on qx.khdxdh=yjzb.KHDXDH inner join khdx_hy hy on yjzb.khdxdh = hy.khdxdh where 1=1 
        <isNotEmpty property="hykhdxdh">and hy.khdxdh in ($hykhdxdh$)</isNotEmpty>  
        <isNotEmpty property="zbdh">and khzb.zbdh=$zbdh$</isNotEmpty>  
        <isNotEmpty property="bz">and yjzb.bz='$bz$'</isNotEmpty>  
        <isNotEmpty property="sdbs">and yjzb.sdbs='$sdbs$'</isNotEmpty> and yjzb.tjrq in($tjrq$,$tjrq_nc$,$tjrq_jc$,$tjrq_yc$,$tjrq_sntq$) and yjzb.sjwd in('2','3') group by yjzb.khdxdh,hy.hydh,hy.hymc,khzb.zbmc,bz.bzzwmc,dmms.dmms ) a order by a.tjrq asc,a.hydh asc
      </isEqual> ) t
    </select>  
    <select id="dn1.hyyjbb_MSQL4SELECT_khzb" parameterClass="java.util.Map" resultClass="java.util.HashMap" remapResults="true">/**!mycat:datanode=$db$**/ select khzbdh as KEY,khzbmc as VALUE from khfa_khzb_hy order by zbpx,zbdh</select> 
  </sqlMap>  
  <rels> 
    <items id="hyyjbb_xsjy1jgj"> 
      <item name="jzsjy" compareValue="hykhzb" operate="isEqual"/> 
    </items>  
    <items id="hyyjbb_xsjy2jgj"> 
      <item name="jzsjy" compareValue="hyfxzb" operate="isEqual"/> 
    </items>  
    <items id="hyyjbb_khzb_tdrjjgj"> 
      <item name="jzsjy" compareValue="gjyjkhzb" operate="isEqual"/> 
    </items>  
    <items id="hyyjbb_fxzb_tdrjjgj"> 
      <item name="jzsjy" compareValue="gjyjfxzb" operate="isEqual"/> 
    </items> 
  </rels>  
  <javascript><![CDATA[jQuery(document).ready(function () {
//这里的js脚本，会在页面加载完成后执行
  init_yjlx().pipe(function(){
    jQuery('#yjlx').bind('change',yjlxChange).trigger('change');
  });
  
  
  jQuery('#qsrq').val( jQuery('#jsrq').val() - 7 );
  $("#query_table tr:eq(1)").append($("<td></td>").append($(".operation[value='查 询']")));
  
  /*
  var qsrq = jQuery('#qsrq').val();
  var jsrq = jQuery('#jsrq').val();
  var qsrq_pre = qsrq.substr(0,4);
  var qsrq_end = qsrq.substr(4);
  var jsrq_pre = jsrq.substr(0,4);
  var jsrq_end = jsrq.substr(4);
  
  //alert(qsrq_pre+"--"+qsrq_end);
  
  jQuery('#qsrq_qn').val( (qsrq_pre-1) + qsrq_end );
  jQuery('#jsrq_qn').val( (jsrq_pre-1) + jsrq_end );*/
  
  //alert(jQuery('#qsrq_qn').val());

});
//自定义验证，在提交时执行。通过返回true，否则返回false
function customValidate(){
  createTime(jQuery('#tjrq'),jQuery('#myForm'));
  tjrqChange();
  $('#tjrq_sntq1').val(parseInt($('#tjrq').val().substr(0,4))-1);
  return true;
}

function changeZbType(){
      var value = jQuery(this).val();
      jQuery('#khzb').hide();
      jQuery('#fxzb').hide();
      jQuery('#'+value).show();
}

function yjlxChange(){
var yjlx = jQuery('#yjlx');
var khzb = jQuery('#khzb');
  if(yjlx.val()=='fxzb'){
    khzb.hide();
    khzb.parent().prev().hide();
    khzb.parent().hide();
    
    $("#ywlb").show();
    $("#zbdh").show();
    $("#sdbs").show();
    $("#bz").show();
    $("#ywlb").parent().prev().show();
    $("#zbdh").parent().prev().show();
    $("#zbdh").parent().show();
    $("#sdbs").parent().prev().show();
    $("#bz").parent().prev().show();
    
  }else{
    khzb.show();
    khzb.parent().prev().show();
    khzb.parent().show();
    
    $("#ywlb").hide();
    $("#zbdh").hide();
    $("#sdbs").hide();
    $("#bz").hide();
    $("#ywlb").parent().prev().hide();
    $("#zbdh").parent().prev().hide();
    $("#zbdh").parent().hide();
    $("#sdbs").parent().prev().hide();
    $("#bz").parent().prev().hide();
   
  }
}

function tjrqChange(){
  //起始日期为当前日期的前1天
  var sysdate =jQuery('#sysDate').val(); 
  var o_yf = createTimeObj($("#tjrq").val());
  var ym = o_yf.ym;//月末
  var yc = o_yf.yc;//月初
  if($('#tjrq').val()==yc || $('#tjrq').val()==ym){
    if($('#yjlx').val()=='fxzb'){
      $('#jzsjy').val('gjyjfxzb');
    }else{
      $('#jzsjy').val('gjyjkhzb');
    }
  }else{
    if($('#yjlx').val()=='fxzb'){
      $('#jzsjy').val('hyfxzb');
    }else{
      $('#jzsjy').val('hykhzb');
    }
  }
}

//日期加减函数
function dayAdd(myTjrq,num){
  var myDate=new Date(myTjrq.substring(0,4) + '-' + myTjrq.substring(4,6) + '-' + myTjrq.substring(6,8));
  var reDate=new Date(Date.parse(myDate) + (86400000 * num))
  var year  = reDate.getFullYear();
  var month = reDate.getMonth()+1;
  var day   = reDate.getDate();
  if(month<10){month=0+""+month;}
  if(day<10){day=0+""+day;}
  return year+""+month+""+day;
}]]></javascript> 
</pageSetting>
