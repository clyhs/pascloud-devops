[{'funId':'jgzxpfdr','funName':'机构在线评分导入','templateJson':[{"id":"defaultCol11","text":"统计日期","type":"date","name":"tjrq","width":"120","length":"100","align":"center","req":"Y","annotate":"","index":0},{"id":"defaultCol1","text":"考核方案","type":"date","name":"famc","width":"120","length":"100","align":"center","req":"Y","annotate":"","index":1},{"id":"defaultCol3","text":"考核指标","type":"date","name":"khzb","width":"120","length":"100","align":"center","req":"Y","annotate":"","index":2},{"id":"defaultCol10","text":"考核机构","type":"date","name":"khjg","width":"120","length":"100","align":"center","req":"Y","annotate":"","index":3},{"id":"defaultCol5","text":"标准分","type":"date","name":"bzf","width":"120","length":"100","align":"center","req":"N","annotate":"","index":4},{"id":"defaultCol6","text":"最高分","type":"date","name":"zgf","width":"120","length":"100","align":"center","req":"N","annotate":"","index":5},{"id":"defaultCol7","text":"最低分","type":"date","name":"zdf","width":"120","length":"100","align":"center","req":"N","annotate":"","index":6},{"id":"defaultCol8","text":"评分","type":"date","name":"pf","width":"120","length":"100","align":"center","req":"Y","annotate":"","index":7}],'templateRuleJson':[{name:'defaultCol11',rules:[{"id":"studio.validate.checkDate","text":"统计日期","name":"defaultCol11","rname":"日期检查","custom":"yyyyMMdd"},{"id":"studio.validate.checkNonNull","text":"统计日期","name":"defaultCol11","rname":"非空检查"}]},{name:'defaultCol1',rules:[{"id":"studio.validate.checkNonNull","text":"考核方案","name":"defaultCol1","rname":"非空检查"},{"id":"jgzxpfdr_checkupdate_famc","text":"考核方案","name":"defaultCol1","rname":"customsql","ruleType":"business","custom":" update $temp$ t set error=error||'考核方案不存在!' where  not exists (\n select 1 from khfa_fapz fapz where trim(t.famc)=trim(fapz.famc) and fapz.zt = '1'\n and cast(substr(cast(t.tjrq as char(8)),1,4) as integer)=cast(fapz.khnf as integer)) and cast(t.khdxdh as integer)=$login_khdxdh$"}]},{name:'defaultCol3',rules:[{"id":"studio.validate.checkNonNull","text":"考核指标","name":"defaultCol3","rname":"非空检查"},{"id":"jgzxpfdr_checkupdate_khzb","text":"考核指标","name":"defaultCol3","rname":"customsql","ruleType":"business","custom":" update $temp$ t set error=error||'考核指标不存在!' where  not exists (\n select 1 from khfa_fapz fapz \n inner join khfa_khzbpz  khzbpz on khzbpz.fabh = fapz.fabh\n inner join khfa_khzb_jg  jg on jg.khzbdh = khzbpz.khzbdh\n where trim(t.famc)=trim(fapz.famc) and fapz.zt = '1'  and  trim(t.khzb)=trim(jg.khzbmc) \n and cast(substr(cast(t.tjrq as char(8)),1,4) as integer)=cast(fapz.khnf as integer)\n and khzbpz.khzbdh >0\n union all\n select 1 from khfa_fapz fapz\n         inner join khfa_khzbpz khzbpz\n            on khzbpz.fabh = fapz.fabh\n         where trim(t.famc) = trim(fapz.famc)\n           and trim(t.khzb) = trim(khzbpz.xmmc)\n           and fapz.zt = '1'\n           and cast(substr(cast(t.tjrq as char(8)), 1, 4) as integer) = cast(fapz.khnf as integer)\n           and khzbpz.khzbdh <= 0\n ) and cast(t.khdxdh as integer)=$login_khdxdh$"}]},{name:'defaultCol10',rules:[{"id":"studio.validate.checkNonNull","text":"考核机构","name":"defaultCol10","rname":"非空检查"},{"id":"jgzxpfdr_checkupdate_khjg","text":"考核机构","name":"defaultCol10","rname":"customsql","ruleType":"business","custom":" update $temp$ t set error=error||'考核机构不存在!' where  not exists (\n select 1 from khfa_fapz fapz \n inner join khfa_zxpffa  zxpffa on zxpffa.fabh = fapz.fabh\n inner join khdx_jg jg on jg.khdxdh = zxpffa.khdxdh\n where trim(t.famc)=trim(fapz.famc)  \n and cast(substr(cast(t.tjrq as char(8)),1,4) as integer)=cast(fapz.khnf as integer)\n and zxpffa.khqm = cast(t.tjrq as integer) and zxpffa.pjr = $login_khdxdh$\n and trim(t.khjg)=trim(jg.jgmc)\n ) and cast(t.khdxdh as integer)=$login_khdxdh$"}]},{name:'defaultCol5',rules:[]},{name:'defaultCol6',rules:[]},{name:'defaultCol7',rules:[]},{name:'defaultCol8',rules:[{"id":"studio.validate.checkNumber","text":"评分","name":"defaultCol8","rname":"数字检查","custom":"21,4"},{"id":"studio.validate.checkNonNull","text":"评分","name":"defaultCol8","rname":"非空检查"},{"id":"jgzxpfdr_checkupdate_pf","text":"评分","name":"defaultCol8","rname":"customsql","ruleType":"business","custom":" update $temp$ t set error=error||'评分不能大于最高分，或者小于最低分!' where   exists (\n select 1 from khfa_fapz fapz \n inner join khfa_khzbpz  khzbpz on khzbpz.fabh = fapz.fabh\n inner join khfa_khzb_jg  jg on jg.khzbdh = khzbpz.khzbdh\n where trim(t.famc)=trim(fapz.famc)  and  trim(t.khzb)=trim(jg.khzbmc) \n and cast(substr(cast(t.tjrq as char(8)),1,4) as integer)=cast(fapz.khnf as integer)\n and khzbpz.khzbdh >0\n and (khzbpz.bdz > cast(t.pf as decimal(25,4)) or khzbpz.fdz < cast(t.pf as decimal(25,4)) )\n union all\n select 1 from khfa_fapz fapz\n         inner join khfa_khzbpz khzbpz\n            on khzbpz.fabh = fapz.fabh\n         where trim(t.famc) = trim(fapz.famc)\n           and trim(t.khzb) = trim(khzbpz.xmmc)\n           and cast(substr(cast(t.tjrq as char(8)), 1, 4) as integer) = cast(fapz.khnf as integer)\n           and khzbpz.khzbdh <= 0\n            and (khzbpz.bdz > cast(t.pf as decimal(25,4)) or khzbpz.fdz < cast(t.pf as decimal(25,4)))\n ) and cast(t.khdxdh as integer)=$login_khdxdh$"}]}],'scJson':{searchConditions:[{"id":"1492417685253","type":"Date","propertyPanel":"date","text":"(统计日期:tjrq)日期控件","row":"0","col":"0","rowspan":"1","colspan":"1","label":"统计日期","name":"tjrq","dateFmt":"yyyyMMdd","defValType":"ym","styleClass":"","minDate":"no","defVal":"","style":"width:250px;","isRequired":"true","editable":"true"},{"id":"1492417702157","type":"MSQL4Select","propertyPanel":"msql4select","text":"(:msql4Select)通用下拉框","row":"1","col":"0","rowspan":"1","colspan":"1","label":"考核方案","name":"khfa","sql":"select distinct fapz.fabh key, fapz.famc value<br/>  from khfa_fapz fapz<br/>  inner join khfa_khzbpz khzbpz on khzbpz.fabh = fapz.fabh<br/> where fapz.khdx = \\'1\\'<br/>   and fapz.khnf =cast( substr(cast($tjrq$ as  char(8)),1,4)  as integer)<br/>   and khzbpz.jsfs = \\'3\\'<br/>   and fapz.zt = \\'1\\'","key_SELECTTYPE":"Integer","defVal":"","parents":"tjrq","width":"250px;","style":"","isAll":"true","isRequired":"false","isEditable":"true","isSearch":"true","isMultiple":"false","mulShowType":"list","selectedList":"1"},{"id":"1492417722129","type":"MSQL4Select","propertyPanel":"msql4select","text":"(:msql4Select)通用下拉框","row":"2","col":"0","rowspan":"1","colspan":"1","label":"考核指标","name":"khzb","sql":"select distinct zbpz.khzbdh as key,zbpz.xmmc as value <br/>  from khfa_khzbpz zbpz<br/> where zbpz.jsfs = \\'3\\'<br/>   and  zbpz.khzbdh <= 0<br/>   and zbpz.fabh in (<br/>       select distinct fapz.fabh <br/>      from khfa_fapz fapz<br/>      inner join khfa_khzbpz khzbpz on khzbpz.fabh = fapz.fabh<br/>     where fapz.khdx = \\'1\\'<br/>       and fapz.khnf =cast( substr(cast($tjrq$ as  char(8)),1,4)  as integer)<br/>       and khzbpz.jsfs = \\'3\\'<br/>       and  fapz.fabh =  $khfa$<br/>       and fapz.zt = \\'1\\'<br/>   )<br/>union all<br/>select distinct jg.khzbdh as key, jg.khzbmc as value  <br/>  from khfa_khzbpz zbpz<br/> inner join khfa_khzb_jg jg<br/>    on jg.khzbdh = zbpz.khzbdh<br/> where zbpz.jsfs = \\'3\\'<br/>   and zbpz.khzbdh > 0<br/>   and zbpz.fabh in (<br/>       select distinct fapz.fabh<br/>      from khfa_fapz fapz<br/>      inner join khfa_khzbpz khzbpz on khzbpz.fabh = fapz.fabh<br/>     where fapz.khdx = \\'1\\'<br/>       and fapz.khnf =cast( substr(cast($tjrq$ as  char(8)),1,4)  as integer)<br/>       and khzbpz.jsfs = \\'3\\'<br/>       and  fapz.fabh =  $khfa$<br/>       and fapz.zt = \\'1\\'<br/>   )","key_SELECTTYPE":"Integer","defVal":"","parents":"khfa","width":"250px;","style":"","isAll":"true","isRequired":"false","isEditable":"true","isSearch":"true","isMultiple":"false","mulShowType":"list","selectedList":"1"},{"id":"1492417735011","type":"Dmms","propertyPanel":"dmms","text":"(:)代码描述","row":"3","col":"0","rowspan":"1","colspan":"1","label":"评分状态","name":"pfzt","dmmc":"pfzt","isAll":"false","defVal":"","width":"250px;","style":"","styleClass":"","editable":"true","multiple":"false","mulShowType":"null","selectedList":"1"},{"id":1492420336698,"type":"Hidden","propertyPanel":"hidden","text":"(:)隐藏域","row":"3","col":"1","rowspan":"1","colspan":"1","name":"khdhmrz","label":"","defVal":"$login_khdxdh$"}]},'selectJson':{"selectIs":"true","selectSQL":"select distinct $tjrq$ as tjrq , fapz.famc ,coalesce(zbjg.khzbmc,khzbpz.xmmc) as khzbmc,\nkhzbpz.zbqz as bzf,khzbpz.bdz as zdf,khzbpz.fdz as zgf\n,jg.jgmc as khjg,zxpfz.pf\nfrom khfa_fapz fapz\ninner join khfa_khzbpz khzbpz on fapz.fabh = khzbpz.fabh\nleft join khfa_khzb_jg zbjg on zbjg.khzbdh = khzbpz.khzbdh\ninner join khfa_zxpffa  zxpffa on zxpffa.fabh = fapz.fabh\ninner join khfa_zxpfz zxpfz on fapz.fabh = zxpfz.fabh and zxpffa.khqs=zxpfz.khqs  and zxpffa.pjr=zxpfz.pjr\n  and zxpfz.khdx='1' and zxpfz.khzbdh = khzbpz.khzbdh  AND zxpffa.KHDXDH=ZXPFZ.KHDXDH\ninner join khdx_jg jg on jg.khdxdh = zxpfz.khdxdh\nwhere fapz.khnf = $tjrq_yyyy$ and fapz.fabh in ($khfa$) and zxpfz.pjr=$pjr$ and zxpffa.khqm=$tjrq$\nand khzbpz.jsfs='3' and zxpffa.khzt ='1' \n and khzbpz.khzbdh in ($khzb$) and zxpffa.pfzt = '$pfzt$'\n and zxpffa.pjr = $khdhmrz$\n and fapz.zt = '1'\n order by fapz.famc ,jg.jgmc","extendAre":""},'targetSetJson':{customSql:'false',customBefor:"",customInsert:null,customAfter:"",koverSql:'true',koverJudge:" update $temp$ t set error=error||'数据已存在!' where   exists (\n select 1 from  khfa_zxpffa fa\n inner join  khfa_fapz fapz   on fapz.fabh = fa.fabh \n inner join  khdx_jg jg on   jg.khdxdh = fa.khdxdh\n where  fapz.zt = '1' and cast(t.tjrq as integer)=fa.khqm\n and t.khdxdh = fa.pjr and fa.pjsj is not null\n and trim(t.famc)=trim(fapz.famc)\n and trim(jg.jgmc) =  trim(t.khjg)\n and fa.khdx ='1'\n )and cast(t.khdxdh as integer)=$login_khdxdh$",koverExcute:"delete from jgzxpfdr_temp  cp where 1=2",koverInsert:"\nupdate khfa_zxpffa zx set zx.pfzt = '1',pjsj = F_GET_SYSTIME()\n     where zx.pjr=$login_khdxdh$ and exists(\n     select 1 from $temp$ t \n     inner join  khfa_fapz fapz on t.famc=fapz.famc\n            and cast(substr(cast(t.tjrq as char(8)),1,4) as integer)=cast(fapz.khnf as integer)\n     inner join khdx_jg  jg on  t.khjg=jg.jgmc      \n     where   zx.fabh = fapz.fabh  and zx.khqm = cast(t.tjrq  as integer) \n            and zx.pjr = t.khdxdh and jg.khdxdh = zx.khdxdh\n            and zx.khdx='1'\n     );\n         \nupdate khfa_zxpfz zx set  zx.pf =\n    (\n     select cast(t.pf as decimal(25,4)) \n     from  $temp$ t \n     inner join  khfa_fapz fapz on t.famc=fapz.famc\n            and cast(substr(cast(t.tjrq as char(8)),1,4) as integer)=cast(fapz.khnf as integer)\n     left join khfa_khzbpz pz on fapz.fabh=pz.fabh  \n     left join khfa_khzb_jg zbjg on  pz.khzbdh=zbjg.khzbdh  \n     inner join khdx_jg  jg on  t.khjg=jg.jgmc\n     where   zx.fabh = fapz.fabh  \n            and zx.khqm = cast(t.tjrq  as integer) \n            and zx.pjr = t.khdxdh \n            and jg.khdxdh = zx.khdxdh\n            and  coalesce(zbjg.khzbmc,pz.xmmc)=t.khzb\n            and pz.khzbdh=zx.khzbdh\n            and zx.khdx='1'\n            AND pz.jsfs='3'\n            AND fapz.yyzlbh=2\n     ),zx.pjbzbh = -1 \n     where\n     exists(\n     select 1 from $temp$ t \n     inner join  khfa_fapz fapz on t.famc=fapz.famc \n            and cast(substr(cast(t.tjrq as char(8)),1,4) as integer)=cast(fapz.khnf as integer)\n     left join khfa_khzbpz pz on fapz.fabh=pz.fabh  \n     left join khfa_khzb_jg zbjg on  pz.khzbdh=zbjg.khzbdh  \n     inner join khdx_jg  jg on  t.khjg=jg.jgmc\n     where   zx.fabh = fapz.fabh  \n            and zx.khqm = cast(t.tjrq as integer) \n            and zx.pjr = t.khdxdh \n            and jg.khdxdh = zx.khdxdh\n            and  coalesce(zbjg.khzbmc,pz.xmmc)=t.khzb\n            and pz.khzbdh=zx.khzbdh\n            and zx.khdx='1'\n            AND pz.jsfs='3'\n            AND fapz.yyzlbh=2);",targetTable:'KHFA_ZXPFZ',cols:[{"cname":"FABH","key":false,"del":false,"tname":"famc","type":"excel","sys":"","lt":"","lc":"","lv":"","cast":" DECIMAL(38,0)","lvCast":"CHAR(12)","selectSql":""},{"cname":"KHQS","key":false,"del":false,"tname":"tjrq","type":"excel","sys":"","lt":"","lc":"","lv":"","cast":" DECIMAL(38,0)","lvCast":"CHAR(12)","selectSql":""},{"cname":"KHZBDH","key":false,"del":false,"tname":"khzb","type":"other","sys":"","lt":"KHFA_KHZB_JG","lc":"KHZBDH","lv":"KHZBMC","cast":" DECIMAL(38,0)","lvCast":" VARCHAR(100)","selectSql":""},{"cname":"PJR","key":false,"del":false,"tname":"tjrq","type":"inner","sys":"$login_khdxdh$","lt":"","lc":"","lv":"","cast":" DECIMAL(38,0)","lvCast":"CHAR(12)","selectSql":""},{"cname":"KHDXDH","key":false,"del":false,"tname":"zgf","type":"other","sys":"","lt":"KHDX_HY","lc":"KHDXDH","lv":"HYDH","cast":" DECIMAL(38,0)","lvCast":" VARCHAR(12)","selectSql":""},{"cname":"PJBZBH","key":false,"del":false,"tname":"zdf","type":"excel","sys":"","lt":"","lc":"","lv":"","cast":" DECIMAL(38,0)","lvCast":"CHAR(12)","selectSql":""},{"cname":"PF","key":false,"del":false,"tname":"pf","type":"excel","sys":"","lt":"","lc":"","lv":"","cast":" DECIMAL(25,4)","lvCast":"CHAR(12)","selectSql":""},{"cname":"KHZQ","key":false,"del":false,"tname":"tjrq","type":"excel","sys":"","lt":"","lc":"","lv":"","cast":" DECIMAL(38,0)","lvCast":"CHAR(12)","selectSql":""},{"cname":"KHDX","key":false,"del":false,"tname":"tjrq","type":"inner","sys":"1","lt":"","lc":"","lv":"","cast":" VARCHAR(2)","lvCast":"CHAR(12)","selectSql":""}]}}]