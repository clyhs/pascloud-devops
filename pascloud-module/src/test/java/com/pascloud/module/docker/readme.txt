To add a worker to this swarm, run the following command:

    docker swarm join \
    --token SWMTKN-1-5rpsvo48osjrhaw9qlmis6foihvgqa9dr82dmn8ilhwr1096an-5ivkrom7l3pjceayw8o3jcpbf \
    192.168.0.17:2377

To add a manager to this swarm, run 'docker swarm join-token manager' and follow the instructions.


docker swarm join \
    --token SWMTKN-1-3ulcvzl9s47oetskb8efsp3ms899oi86rxbq1n7pphapbgghka-9q4g4hobd9mub180ks80wqvtg \
    192.168.0.16:2377
初始化报错

https://www.cnblogs.com/kongfwy/p/6597161.html

Error response from daemon: --live-restore daemon configuration is incompatible with swarm mode


修改/etc/docker/daemon.json文件，true改为false

{
    "live-restore": false
}


1.listimages()
{"created":"1509748757","id":"sha256:6ad733544a6317992a6fac4eb19fe1df577d4dec7529efec28a5bd0edad0fd30","parentId":"","repoTags":["busybox:latest"],"repoDigests":["busybox@sha256:bbc3a03235220b170ba48a157dd097dd1379299370e1ed99ce976df0355d24f0"],"size":1129289,"virtualSize":1129289}
{"created":"1509026348","id":"sha256:1616e2759a8ebc2ac1954533ccd4298c268306ddf05b6652fc3c646e420216f4","parentId":"","repoTags":["zabbix/zabbix-agent:latest"],"size":56662411,"virtualSize":56662411,"labels":{"maintainer":"Alexey Pustovalov \u003calexey.pustovalov@zabbix.com\u003e"}}
{"created":"1488322454","id":"sha256:47a81cdb853be1688596dd357feeb5f0886fd5bafd109d5763cc302404bcd51d","parentId":"","repoTags":["rethinkdb:latest"],"size":181786068,"virtualSize":181786068,"labels":{}}
{"created":"1484706726","id":"sha256:36b1e23becabc0b27c5787712dce019982c048665fd9e7e6cb032a46bcac510d","parentId":"","repoTags":["swarm:latest"],"size":15852351,"virtualSize":15852351,"labels":{}}
{"created":"1451362632","id":"sha256:cfee14e5d6f280892b9fb16e830aae5c9458e61a7502048ac45b6b1723e8b0b9","parentId":"","repoTags":["shipyard/docker-proxy:latest"],"size":9463693,"virtualSize":9463693,"labels":{}}
{"created":"1439009020","id":"sha256:6aef84b9ec5a64742d9a24a5191c9b17a48a12a57168d5cc5d053725d8d555c2","parentId":"","repoTags":["microbox/etcd:latest"],"size":17862381,"virtualSize":17862381,"labels":{}}

2.listnodes()

{"id":"l5pseptc4q9qpmq178rf75gih","version":{"index":9},"createdAt":"Dec 13, 2017 11:29:06 AM","updatedAt":"Dec 13, 2017 11:29:07 AM","spec":{"role":"manager","availability":"active"},"description":{"hostname":"centosdb.pascloud.com","platform":{"architecture":"x86_64","os":"linux"},"resources":{"nanoCpus":16000000000,"memoryBytes":84298596352},"engine":{"engineVersion":"1.13.1","plugins":[{"type":"Network","name":"bridge"},{"type":"Network","name":"host"},{"type":"Network","name":"macvlan"},{"type":"Network","name":"null"},{"type":"Network","name":"overlay"},{"type":"Volume","name":"local"}]}},"status":{"state":"ready","addr":"127.0.0.1"},"managerStatus":{"leader":true,"reachability":"reachable","addr":"192.168.0.17:2377"}}
{"id":"laj6f0cwr4ramgfsgf8t25404","version":{"index":15},"createdAt":"Dec 13, 2017 11:31:05 AM","updatedAt":"Dec 13, 2017 11:31:05 AM","spec":{"role":"worker","availability":"active"},"description":{"hostname":"centoss2.pascloud.com","platform":{"architecture":"x86_64","os":"linux"},"resources":{"nanoCpus":8000000000,"memoryBytes":16659865600},"engine":{"engineVersion":"1.13.1","plugins":[{"type":"Network","name":"bridge"},{"type":"Network","name":"host"},{"type":"Network","name":"macvlan"},{"type":"Network","name":"null"},{"type":"Network","name":"overlay"},{"type":"Volume","name":"local"}]}},"status":{"state":"ready","addr":"192.168.0.7"}}

3.listcontainer()

{"id":"a7051c54908d4728def725eb4aa450367a0a6d528ce52b416f3f212901664822","names":["/shipyard-proxy"],"image":"shipyard/docker-proxy:latest","imageId":"sha256:cfee14e5d6f280892b9fb16e830aae5c9458e61a7502048ac45b6b1723e8b0b9","command":"/usr/local/bin/run","created":1513143941,"state":"running","status":"Up 21 minutes","ports":[{"privatePort":2375,"publicPort":2375,"type":"tcp","ip":"0.0.0.0"}],"labels":{},"networkSettings":{"ports":{},"networks":{"bridge":{"networkId":"678c4a99af808e6ed174ca41eab7837d9e76cdda0f632f559ccb1e22c87ae67d","endpointId":"9dc9366bdad2ce0f71c0e4460b23f3b35fb0b232d6661835799c8fabb7639635","gateway":"172.17.0.1","ipAddress":"172.17.0.3","ipPrefixLen":16,"ipv6Gateway":"","globalIPv6Address":"","globalIPv6PrefixLen":0,"macAddress":"02:42:ac:11:00:03"}}},"mounts":[{"type":"bind","source":"/var/run/docker.sock","destination":"/var/run/docker.sock","mode":"","rw":true,"propagation":""}]}
{"id":"6d09536f7e587c070376045861fe31064e13d2cc74db4645f26eecb274d00e7f","names":["/some-zabbix-agent"],"image":"zabbix/zabbix-agent","imageId":"sha256:1616e2759a8ebc2ac1954533ccd4298c268306ddf05b6652fc3c646e420216f4","command":"/bin/bash /run_zabbix_component.sh agentd none","created":1511228035,"state":"running","status":"Up 3 weeks","ports":[{"privatePort":10050,"publicPort":10050,"type":"tcp","ip":"0.0.0.0"}],"labels":{"maintainer":"Alexey Pustovalov \u003calexey.pustovalov@zabbix.com\u003e"},"networkSettings":{"ports":{},"networks":{"bridge":{"networkId":"678c4a99af808e6ed174ca41eab7837d9e76cdda0f632f559ccb1e22c87ae67d","endpointId":"250e4e6c4959e02eeb2286a0e6865ef4f661d72689b1de35ae82d9293c30de1a","gateway":"172.17.0.1","ipAddress":"172.17.0.2","ipPrefixLen":16,"ipv6Gateway":"","globalIPv6Address":"","globalIPv6PrefixLen":0,"macAddress":"02:42:ac:11:00:02"}}},"mounts":[{"type":"volume","name":"1b50b7a139ce2837cde1130f923efd45bae8bf7e5647373cc4190ed57d2d5145","source":"/var/lib/docker/volumes/1b50b7a139ce2837cde1130f923efd45bae8bf7e5647373cc4190ed57d2d5145/_data","destination":"/var/lib/zabbix/modules","driver":"local","mode":"","rw":true,"propagation":""},{"type":"volume","name":"6e4591d7538edc622e5085b3f69b9b2c6e4cbb7d45a4d84d99fc96e44d8a9c02","source":"/var/lib/docker/volumes/6e4591d7538edc622e5085b3f69b9b2c6e4cbb7d45a4d84d99fc96e44d8a9c02/_data","destination":"/etc/zabbix/zabbix_agentd.d","driver":"local","mode":"","rw":true,"propagation":""},{"type":"volume","name":"22345154c28c8b2b676c3bb38be4bf579904e96019c7270a41f66f22989a0149","source":"/var/lib/docker/volumes/22345154c28c8b2b676c3bb38be4bf579904e96019c7270a41f66f22989a0149/_data","destination":"/var/lib/zabbix/enc","driver":"local","mode":"","rw":true,"propagation":""}]}

4.inspectSwarm
{"id":"ss64pzvinnt7jm9m01mi41y1a","version":{"index":10},"createdAt":"Dec 13, 2017 11:29:06 AM","updatedAt":"Dec 13, 2017 11:29:07 AM","swarmSpec":{"name":"default","orchestration":{"taskHistoryRetentionLimit":5},"raft":{"snapshotInterval":10000,"keepOldSnapshots":0,"logEntriesForSlowFollowers":500,"electionTick":3,"heartbeatTick":1},"dispatcher":{"heartbeatPeriod":5000000000},"caConfig":{"nodeCertExpiry":7776000000000000},"encryptionConfig":{"autoLockManagers":false},"taskDefaults":{}},"joinTokens":{"worker":"SWMTKN-1-5rpsvo48osjrhaw9qlmis6foihvgqa9dr82dmn8ilhwr1096an-5ivkrom7l3pjceayw8o3jcpbf","manager":"SWMTKN-1-5rpsvo48osjrhaw9qlmis6foihvgqa9dr82dmn8ilhwr1096an-b9315fdmpdkm6tbo41n115w0v"}}

containerinfo
{"id":"6885358a836d8f257c614adb03cadd76fe917bf2e472b66eb5f2d6e2c1b5f94f","created":"Dec 18, 2017 1:40:51 PM","path":"catalina.sh","args":["run"],"config":{"hostname":"6885358a836d","domainname":"","user":"","attachStdin":false,"attachStdout":false,"attachStderr":false,"exposedPorts":["8080","8080/tcp"],"tty":false,"openStdin":false,"stdinOnce":false,"env":["PATH\u003d/usr/local/tomcat/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin","LANG\u003dC.UTF-8","JAVA_HOME\u003d/docker-java-home/jre","JAVA_VERSION\u003d8u151","JAVA_DEBIAN_VERSION\u003d8u151-b12-1~deb9u1","CA_CERTIFICATES_JAVA_VERSION\u003d20170531+nmu1","CATALINA_HOME\u003d/usr/local/tomcat","TOMCAT_NATIVE_LIBDIR\u003d/usr/local/tomcat/native-jni-lib","LD_LIBRARY_PATH\u003d/usr/local/tomcat/native-jni-lib","OPENSSL_VERSION\u003d1.1.0f-3+deb9u1","GPG_KEYS\u003d05AB33110949707C93A279E3D3EFE6B686867BA6 07E48665A34DCAFAE522E5E6266191C37C037D42 47309207D818FFD8DCD3F83F1931D684307A10A5 541FBE7D8F78B25E055DDEE13C370389288584E7 61B832AC2F1C5A90F0F9B00A1C506407564C17A3 713DA88BE50911535FE716F5208B0AB1D63011C7 79F7026C690BAA50B92CD8B66A3AD3F4F22C4FED 9BA44C2621385CB966EBA586F72C284D731FABEE A27677289986DB50844682F8ACB77FC2E86E29AC A9C5DF4D22E99998D9875A5110C01C5A2F6059E7 DCFD35E0BF8CA7344752DE8B6FB21E8933C60243 F3A04C595DB5B6A5F1ECA43E3B7BBB100D811BBE F7DA48BB64BCB84ECBA7EE6935CD23C10D498E23","TOMCAT_MAJOR\u003d8","TOMCAT_VERSION\u003d8.5.24","TOMCAT_SHA1\u003d9e26ba61c5665aafc849073edeb769be555283cd","TOMCAT_TGZ_URLS\u003dhttps://www.apache.org/dyn/closer.cgi?action\u003ddownload\u0026filename\u003dtomcat/tomcat-8/v8.5.24/bin/apache-tomcat-8.5.24.tar.gz \thttps://www-us.apache.org/dist/tomcat/tomcat-8/v8.5.24/bin/apache-tomcat-8.5.24.tar.gz \thttps://www.apache.org/dist/tomcat/tomcat-8/v8.5.24/bin/apache-tomcat-8.5.24.tar.gz \thttps://archive.apache.org/dist/tomcat/tomcat-8/v8.5.24/bin/apache-tomcat-8.5.24.tar.gz","TOMCAT_ASC_URLS\u003dhttps://www.apache.org/dyn/closer.cgi?action\u003ddownload\u0026filename\u003dtomcat/tomcat-8/v8.5.24/bin/apache-tomcat-8.5.24.tar.gz.asc \thttps://www-us.apache.org/dist/tomcat/tomcat-8/v8.5.24/bin/apache-tomcat-8.5.24.tar.gz.asc \thttps://www.apache.org/dist/tomcat/tomcat-8/v8.5.24/bin/apache-tomcat-8.5.24.tar.gz.asc \thttps://archive.apache.org/dist/tomcat/tomcat-8/v8.5.24/bin/apache-tomcat-8.5.24.tar.gz.asc"],"cmd":["catalina.sh","run"],"image":"tomcat:latest","workingDir":"/usr/local/tomcat","labels":{}},"hostConfig":{"binds":["/pascloud16/test/:/usr/local/tomcat/webapps"],"blkioWeight":0,"containerIdFile":"","privileged":false,"portBindings":{"8080":[{"hostIp":"0.0.0.0","hostPort":"7777"}]},"publishAllPorts":false,"networkMode":"default","memory":0,"memorySwap":0,"memorySwappiness":-1,"memoryReservation":0,"cpuPeriod":0,"cpuShares":0,"cpusetCpus":"","cpusetMems":"","cpuQuota":0,"cgroupParent":"","restartPolicy":{"name":"","maxRetryCount":0},"logConfig":{"logType":"journald","logOptions":{}},"ipcMode":"","pidMode":"","shmSize":67108864,"oomKillDisable":false,"oomScoreAdj":0,"autoRemove":false,"pidsLimit":0,"readonlyRootfs":false},"state":{"status":"running","running":true,"paused":false,"restarting":false,"pid":4408,"exitCode":0,"startedAt":"Dec 18, 2017 1:40:51 PM","finishedAt":"Jan 1, 0001 8:00:00 AM","error":"","oomKilled":false},"image":"sha256:3dcfe809147daf54fbdbe1f6886b4c49df63f28e2b3c8ac119fef6a7f7490d3c","networkSettings":{"ipAddress":"172.17.0.11","ipPrefixLen":16,"gateway":"172.17.0.1","bridge":"","ports":{"8080/tcp":[{"hostIp":"0.0.0.0","hostPort":"7777"}]},"macAddress":"02:42:ac:11:00:0b","networks":{"bridge":{"networkId":"1d679726e18c87ebb2430f406b8ff19cfbb7f95e34fccfac8712c156531cec97","endpointId":"1563c37fd8292de63b2b4dd011d76f867fd7d43e18c0991a73baa23305bdac1f","gateway":"172.17.0.1","ipAddress":"172.17.0.11","ipPrefixLen":16,"ipv6Gateway":"","globalIPv6Address":"","globalIPv6PrefixLen":0,"macAddress":"02:42:ac:11:00:0b"}},"endpointId":"1563c37fd8292de63b2b4dd011d76f867fd7d43e18c0991a73baa23305bdac1f","sandboxId":"6a09cccb1c3c599a588f0662b598055d213ce278d9185f98864d8a38b85d99d8","sandboxKey":"/var/run/docker/netns/6a09cccb1c3c","hairpinMode":false,"linkLocalIPv6Address":"","linkLocalIPv6PrefixLen":0,"globalIPv6Address":"","globalIPv6PrefixLen":0,"ipv6Gateway":""},"resolvConfPath":"/var/lib/docker/containers/6885358a836d8f257c614adb03cadd76fe917bf2e472b66eb5f2d6e2c1b5f94f/resolv.conf","hostnamePath":"/var/lib/docker/containers/6885358a836d8f257c614adb03cadd76fe917bf2e472b66eb5f2d6e2c1b5f94f/hostname","hostsPath":"/var/lib/docker/containers/6885358a836d8f257c614adb03cadd76fe917bf2e472b66eb5f2d6e2c1b5f94f/hosts","name":"/tomcat_test","driver":"devicemapper","processLabel":"","mountLabel":"","appArmorProfile":"","logPath":"","restartCount":0,"mounts":[{"source":"/pascloud16/test","destination":"/usr/local/tomcat/webapps","mode":"","rw":true,"propagation":"rprivate"}]}

docker run -d --name paspb -v /usr/local/tomcat7/webapps:/usr/local/tomcat/webapps -p 7777:8080 tomcat:7.0.82-jre8
